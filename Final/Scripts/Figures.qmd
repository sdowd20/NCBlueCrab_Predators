---
title: "Figures"
format: html
editor: visual
---

Code to generate figures created in R for the manuscript titled "Predicting Predator Abundance from Prey in Estuaries: Insights from Single and Joint Species Distribution Modeling". The data/functions needed are loaded in from the Load.Figures.R script.

```{r}
source("/users/sallydowd/Documents/GitHub/NCBlueCrab_Predators/Final/Scripts/Load.Figures.R")
source("/users/sallydowd/Documents/GitHub/NCBlueCrab_Predators/Final/Scripts/Load.SDM.Final.R")
```

## Main text

### Figure 1:

```{r}
standard2 <- standard_theme + theme(legend.title= element_text(size = 14), legend.text = element_text(size= 12), axis.text=element_text(size=12),axis.title=element_text(size=14)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))  + theme(plot.margin = margin(1, 1, 1, 1))

#A) 
plot_usmap(fill= "lightgray") + standard_theme +
  scale_fill_manual(values = c("gray")) + theme(panel.background = element_rect(fill= "white"), axis.text.x = element_blank(), axis.text.y = element_blank(), axis.ticks.x=element_blank(), axis.ticks.y=element_blank(), axis.title.x = element_blank(), axis.title.y = element_blank()) 
ggsave("/users/sallydowd/Desktop/us_map.png", width= 7, height=5, dpi= 500)

ggplot(data = world) + geom_sf() + theme(panel.background = element_rect(fill = "white", colour = "black")) + coord_sf(xlim=c(-78.5, -75.4), ylim=c(33.802938,36.672128), expand = TRUE) + standard2 + theme(axis.text.x = element_blank(), axis.text.y = element_blank(), axis.ticks.x=element_blank(), axis.ticks.y=element_blank(), axis.title.x = element_blank(), axis.title.y = element_blank())
ggsave("/users/sallydowd/Desktop/nc_map.png", width= 3.5, height=2, dpi= 500)

#B) 
t4 <- ggplot(data = world) + geom_sf() + theme(panel.background = element_rect(fill = "white", colour = "black")) + geom_point(data = filter(p915_CPUEedt, !Latitude== 33.72389, !Latitude == 35.95528, !Latitude == 36.04694, !(Latitude > 34.5 & Longitude < -77.5), Month %in% c(5,6)), aes(x = Longitude, y = Latitude, colour= Survey), size = .5) + geom_point(data = subset(p120_CPUEedt, Month %in% c(5,6)), aes(x = Longitude, y = Latitude, colour= Survey), size = .5) + coord_sf(xlim=c(-78.5, -75.4), ylim=c(33.802938,36.672128), expand = TRUE) + ggtitle("B) Sampling points") +scale_color_manual(values= c("steelblue", "#E69F00"), name= "Survey") +  guides(color = guide_legend(override.aes = list(size = 2))) + standard2 + coord_sf(xlim=c(-78.5, -75.4), ylim=c(33.802938,36.672128), expand = TRUE)

#C) 
t2 <- ggplot(data = world) + geom_sf() + geom_sf(data = globe_grid_30_edt, fill = NA) + coord_sf(xlim=c(-85, -70), ylim=c(25,40), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + geom_point(data = subset(p915_CPUEedt_fig12, Month %in% c(5,6)), aes(x = Longitude, y = Latitude, colour= Survey), size = .5) + geom_point(data = subset(p120_CPUEedt_fig12, Month %in% c(5,6)), aes(x = Longitude, y = Latitude, colour= Survey), size = .5) + ggtitle("D) 0.12° x 0.12°")+scale_color_manual(values= c("steelblue", "#E69F00"), name= "Survey") +  guides(color = guide_legend(override.aes = list(size = 2))) + standard2 + coord_sf(xlim=c(-78.5, -75.4), ylim=c(33.802938,36.672128), expand = TRUE)
```

### Figure 3:
```{r}
#Red drum 
reddrum_model1 <- read.csv("/users/sallydowd/Desktop/reddrum_model1.csv")
reddrum_model2 <- read.csv("/users/sallydowd/Desktop/reddrum_model2.csv")
reddrum_model3 <- read.csv("/users/sallydowd/Desktop/reddrum_model3.csv")

reddrum_model1 <- reddrum_model1 %>% dplyr::select(-X) %>% mutate(Model_type = "Low")
reddrum_model2 <- reddrum_model2 %>% dplyr::select(-X) %>% mutate(Model_type = "Medium")
reddrum_model3 <- reddrum_model3 %>% dplyr::select(-X) %>% mutate(Model_type = "High")

reddrum_r2 <- rbind(reddrum_model1, reddrum_model2, reddrum_model3) %>% dplyr::select(-rmse_con, -rmse_uncon)
reddrum_r2 <- reddrum_r2 %>% pivot_longer(cols= c(r2_con, r2_uncon), names_to = "prediction_type", values_to = "value") 
reddrum_r2$prediction_type <- factor(reddrum_r2$prediction_type, levels = c("r2_uncon", "r2_con")) 
reddrum_r2$Model_type <- factor(reddrum_r2$Model_type, levels = c("Low", "Medium", "High"))
new_labels <- c("r2_uncon" = "Traditional", "r2_con" = "Conditional")
mean_reddrum_r2 <- reddrum_r2 %>% group_by(Model_type, prediction_type) %>%
summarize(mean_value = mean(value), .groups = 'drop')

fig3_rd <- ggplot() + geom_boxplot(aes(x= Model_type, y = value), data= reddrum_r2) +  geom_point(data = mean_reddrum_r2, aes(x = Model_type, y = mean_value), color = "red", size = 2) +  facet_wrap(~prediction_type, scales= "free", labeller= as_labeller(new_labels)) + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("R"^"2"))) + labs(tag= "A)") +  
geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.60, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 0.75, label= "") + geom_bracket(xmin= 2.1, xmax=3, y.position= 0.60, label= "") + ylim(-1.2, 1.0) + theme(axis.text.x = element_text(angle = 360)) + ggtitle("Red drum") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r}
#Southern kingfish 
sk_model1 <- read.csv("/users/sallydowd/Desktop/southernkingfish_model1.csv")
sk_model2 <- read.csv("/users/sallydowd/Desktop/southernkingfish_model2.csv")
sk_model3 <- read.csv("/users/sallydowd/Desktop/southernkingfish_model3.csv")

sk_model1 <- sk_model1 %>% dplyr::select(-X) %>% mutate(Model_type = "Low")
sk_model2 <- sk_model2 %>% dplyr::select(-X) %>% mutate(Model_type = "Medium")
sk_model3 <- sk_model3 %>% dplyr::select(-X) %>% mutate(Model_type = "High")

sk_r2 <- rbind(sk_model1, sk_model2, sk_model3) %>% dplyr::select(-rmse_con, -rmse_uncon)
sk_r2 <- sk_r2 %>% pivot_longer(cols= c(r2_con, r2_uncon), names_to = "prediction_type", values_to = "value") 
sk_r2$prediction_type <- factor(sk_r2$prediction_type, levels = c("r2_uncon", "r2_con")) 
sk_r2$Model_type <- factor(sk_r2$Model_type, levels = c("Low", "Medium", "High"))
new_labels <- c("r2_uncon" = "Traditional", "r2_con" = "Conditional")
mean_sk_r2 <- sk_r2 %>% group_by(Model_type, prediction_type) %>%
summarize(mean_value = mean(value), .groups = 'drop')

fig3_sk <- ggplot() + geom_boxplot(aes(x= Model_type, y = value), data= sk_r2) +  geom_point(data = mean_sk_r2, aes(x = Model_type, y = mean_value), color = "red", size = 2) +  facet_wrap(~prediction_type, scales= "free", labeller= as_labeller(new_labels)) + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("R"^"2"))) + labs(tag= "B)") + expand_limits(y= c(0.0015, 0.23)) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.21, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 0.23, label= "") + geom_bracket(xmin= 2.1, xmax=3, y.position= 0.21, label= "") + theme(axis.text.x = element_text(angle = 360)) + ggtitle("Southern kingfish") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r}
#Black drum 
bd_model1 <- read.csv("/users/sallydowd/Desktop/blackdrum_model1.csv")
bd_model2 <- read.csv("/users/sallydowd/Desktop/blackdrum_model2.csv")
bd_model3 <- read.csv("/users/sallydowd/Desktop/blackdrum_model3.csv")

bd_model1 <- bd_model1 %>% dplyr::select(-X) %>% mutate(Model_type = "Low")
bd_model2 <- bd_model2 %>% dplyr::select(-X) %>% mutate(Model_type = "Medium")
bd_model3 <- bd_model3 %>% dplyr::select(-X) %>% mutate(Model_type = "High")

bd_r2 <- rbind(bd_model1, bd_model2, bd_model3) %>% dplyr::select(-rmse_con, -rmse_uncon)
bd_r2 <- bd_r2 %>% pivot_longer(cols= c(r2_con, r2_uncon), names_to = "prediction_type", values_to = "value") 
bd_r2$prediction_type <- factor(bd_r2$prediction_type, levels = c("r2_uncon", "r2_con")) 
bd_r2$Model_type <- factor(bd_r2$Model_type, levels = c("Low", "Medium", "High"))
new_labels <- c("r2_uncon" = "Traditional", "r2_con" = "Conditional")
mean_bd_r2 <- bd_r2 %>% group_by(Model_type, prediction_type) %>%
summarize(mean_value = mean(value), .groups = 'drop')

fig3_bd <- ggplot() + geom_boxplot(aes(x= Model_type, y = value), data= bd_r2) +  geom_point(data = mean_bd_r2, aes(x = Model_type, y = mean_value), color = "red", size = 2) +  facet_wrap(~prediction_type, scales= "free", labeller= as_labeller(new_labels)) + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("R"^"2"))) + labs(tag= "C)")  + theme(axis.text.x = element_text(angle = 360)) + ggtitle("Black drum") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + expand_limits(y= c(0, 1.5)) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 1, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 1.6, label= "") + geom_bracket(xmin= 2.1, xmax=3, y.position= 1, label= "")
```

```{r}
fig <- ggarrange(fig3_rd + rremove("xlab") + rremove("ylab"), fig3_sk + rremove("xlab") + rremove("ylab"), fig3_bd + rremove("xlab") + rremove("ylab"), ncol= 3)
library(grid)
annotate_figure(fig, bottom= textGrob("Model type"), left= textGrob(expression(paste("R"^"2")), rot= 90))
ggsave("/users/sallydowd/Desktop/Graphs_edit/figure3.pdf", width= 13, height= 6)
```

## Appendix A: Introduction & Methods

### Fig A.2:
```{r}
#0.06: find number of presence/abscence
df_count_wide_both06 %>% filter(reddrumP915 > 0) 
##397 observations total 
##Positive observations: red drum: 164, black drum: 130, southern kingfish: 65
##Zero observations: 233, 267, 332

data2 <- data.frame(species = c("Red drum", "Black drum", "Southern kingfish", "Red drum", "Black drum", "Southern kingfish"), count = c(397,397,397, 164, 130, 65), pattern= c("0", "0", "0", "pos", "pos", "pos"), grid = c(.06,.06,.06,.06,.06,.06))

#0.12
data <- data.frame(species = c("Red drum", "Black drum", "Southern kingfish", "Red drum", "Black drum", "Southern kingfish"), count = c(572,572,572, 181, 112, 68), pattern= c("0", "0", "0", "pos", "pos", "pos"), grid = c(.12,.12,.12,.12,.12,.12))

data_t <- rbind(data, data2)

#0.24
df_count_wide_both24  %>% filter(southernkingfishP915 > 0)

data3 <- data.frame(species = c("Red drum", "Black drum", "Southern kingfish", "Red drum", "Black drum", "Southern kingfish"), count = c(432,432,432, 258, 220, 130), pattern= c("0", "0", "0", "pos", "pos", "pos"), grid = c(.24,.24,.24,.24,.24,.24))
data_t <- rbind(data, data2, data3)

data_t$grid <- factor(data_t$grid, levels = c(0.06, 0.12, 0.24))

ggplot(data_t, aes(x= grid, y = count, fill = species, alpha= pattern)) + standard_theme + labs(x= "Grid cell size", y= "Number of data records", fill= "Species") + scale_fill_manual(values= c("#0072B2", "#009E73", "#CC6666"), name= "Species") + geom_bar(stat= "identity") + guides(alpha = guide_legend(title = "Type of observation")) + scale_alpha_manual(values = c("pos" = 0.6, "neg" = 1), labels= "Positive encounter") + scale_x_discrete(labels= c("0.06° x 0.06°", "0.12° x 0.12°", "0.24° x 0.24°"))
```

### Fig A.4
```{r}
df_CPUE_length <- read.csv("/users/sallydowd/Documents/GitHub/NCBlueCrab_Predators/Final/Data/CPUE_grid_avg_lengthedt.03.04.24.csv")
df_CPUE_length <- df_CPUE_length[,-1]
df_CPUE_length <- df_CPUE_length %>% mutate_at("Survey", as.factor)
df_CPUE_length$Speciescommonname <- gsub(" ", "", df_CPUE_length$Speciescommonname)
colnames(df_CPUE_length) <- gsub(pattern = "_", replacement = "", colnames(df_CPUE_length))

df_CPUE_length$SpeciesSurvey <- paste(df_CPUE_length$Speciescommonname, df_CPUE_length$Survey, sep= "")
df_CPUE_length$meanCPUE <- as.numeric(df_CPUE_length$meanCPUE)
df_CPUE_length_wide_both <- df_CPUE_length %>% filter(Survey %in% "P120"|Survey %in% "P915") %>% dplyr::select(-Speciescommonname, -Survey) %>% ungroup() %>% pivot_wider(names_from = "SpeciesSurvey", values_from = "meanCPUE") %>% drop_na()

cor <- cor(df_CPUE_length_wide_both[, c(2, 4:5, 7:11)])
corrplot(cor, mar= c(3,3,3,3))
```

### Fig A.4

Fig. A.4 was generated through the Autocorrelation.Rmd under Scripts. 

### Fig A.6
```{r}
source("~/Documents/GitHub/NCBlueCrab_Predators/Scripts/Load.SDM.Final.R")
```

```{r}
newdf <- df_CPUE_length_wide_both %>% group_by(Month, Year) %>% summarize(reddrumP915forage = sum(logreddrumP915forageP915), reddrumP120forage = sum(logreddrumP915forageP120), southernkingfishP915forage = sum(logsouthernkingfishP915forageP915), southernkingfishP120forage = sum(logsouthernkingfishP915forageP120), blackdrumP120forage = sum(logblackdrumP915forageP120)) %>% pivot_longer(cols= c(reddrumP915forage, reddrumP120forage, southernkingfishP915forage, southernkingfishP120forage, blackdrumP120forage), names_to= "Speciesforage", values_to= "Value") %>% mutate(Month=ifelse(Month == 5, "May", "June"))

newdf <- newdf %>% mutate(Speciesforage= fct_relevel(Speciesforage, "reddrumP120forage", "southernkingfishP120forage", "blackdrumP120forage", "southernkingfishP915forage", "reddrumP915forage")) 

cbPalette <- c("#999999", "#56B4E9", "#009E73", "#D55E00", "#CC79A7")

t3<- newdf %>% ungroup() %>% ggplot(aes(fill= Speciesforage, y= Value, x= Year)) + geom_bar(position="stack", stat="identity") + facet_wrap(~factor(Month, levels= c("May", "June")), scales= "free") + theme(panel.spacing= unit(1,"lines")) + standard_theme + scale_fill_manual(values=cbPalette) + scale_y_continuous(expand = c(0, 0)) + labs(fill= "Total prey index")
t3 + theme(legend.position = "none")
ggsave("/users/sallydowd/Desktop/test.jpeg", width= 8, height= 5, dpi= 300)
library(cowplot)
library(ggpubr)
leg <- get_legend(t3 + labs(fill= "Prey items consumed"))
as_ggplot(leg)
ggsave("~/Desktop/t32_legend.png", dpi=300, width=6, height=4)
```

### Fig A.7
```{r}
#Combine length datasets for plotting 
p915_gg <- p915_length_toplot %>% ungroup() %>% dplyr::select(Length, Speciescommonname, Colnum, Survey)
p915_gg[,4] <- "Gillnet"
p120_gg <- P120_os_prop_edt %>% ungroup() %>% dplyr::select(Length, Speciescommonname, Colnum, Survey)
p120_gg %>% group_by(Speciescommonname) %>% summarize(sum= sum(Colnum))
p120_gg[,4] <- "Trawl"
combo <- rbind(p915_gg, p120_gg)
```

```{r}
combo %>% drop_na(Length) %>% group_by(Speciescommonname) %>% ggplot() + geom_histogram(aes(x= Length, fill= Survey), bins= 15, alpha= 0.7) + facet_wrap(~Speciescommonname, scale= "free_y") + standard_theme + labs(x= "Length", y= "Count") + scale_fill_manual(values= c("steelblue", "#E69F00"), name= "Survey") + xlim(0,750)
ggsave("/users/sallydowd/Desktop/length.fig.png", width= 8, height=6, dpi= 500)
```

### Fig A.8
```{r}
t1 <- ggplot() + geom_histogram(aes(x= reddrumP915forageP915), data= df_CPUE_length_wide_both) + standard_theme + xlab("Red drum P915 total prey CPUE P915") + ylab("Count") + labs(tag= "A)")
ggplot() + geom_histogram(aes(x= logreddrumP915forageP915), data= df_CPUE_length_wide_both) + standard_theme + xlab("Log Red drum P915 total prey CPUE P915") + ylab("Count") + labs(tag= "A)")

t2 <- ggplot() + geom_histogram(aes(x= reddrumP915forageP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Red drum P120 total prey CPUE") + ylab("Count")
ggplot() + geom_histogram(aes(x= logreddrumP915forageP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Log Red drum P120 total prey CPUE") + ylab("Count")

t3 <- ggplot() + geom_histogram(aes(x= southernkingfishP915forageP915), data= df_CPUE_length_wide_both) + standard_theme + xlab("Southern kingfish P915 total prey CPUE") + ylab("Count") + labs(tag= "B)")
ggplot() + geom_histogram(aes(x= logsouthernkingfishP915forageP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Log Southern kingfish P120 total prey CPUE") + ylab("Count")

t4 <- ggplot() + geom_histogram(aes(x= southernkingfishP915forageP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Southern kingfish P120 total prey CPUE") + ylab("Count")
ggplot() + geom_histogram(aes(x= logsouthernkingfishP915forageP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Log southern kingfish P120 total prey CPUE") + ylab("Count")

t5 <- ggplot() + geom_histogram(aes(x= blackdrumP915forageP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Black drum P120 total prey CPUE") + ylab("Count") + labs(tag= "C)")
ggplot() + geom_histogram(aes(x= logblackdrumP915forageP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Log black drum P120 total prey CPUE") + ylab("Count") + labs(tag= "C)")

t6 <- ggplot() + geom_histogram(aes(x= smallbluecrabP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Blue crab P120 CPUE") + ylab("Count") + labs(tag= "D)")
ggplot() + geom_histogram(aes(x= logsmallbluecrabP120), data= df_CPUE_length_wide_both) + standard_theme + xlab("Log blue crab P120 CPUE") + ylab("Count") + labs(tag= "D)")
```

### Fig A.9-11 and Fig. A.13-15

This figures were generated in PIPIIburnin.qmd from gJam objects with a variation of this line of code:

## Appendix B: Results

### Fig B.1

```{r}
#Best GAMs
reddrum_env_bc <- gam(reddrumP915~s(avgdepth)+s(avgssal)+s(avgstemp)+s(avgsdo)+s(NoFishRest)+factor(Yearfactor) + s(logsmallbluecrabP120), family= tw(), data=df_CPUE_length_wide_both)

southernkingfish_env_forage <- gam(southernkingfishP915~s(avgdepth)+s(avgssal)+s(avgstemp)+s(avgsdo)+s(NoFishRest)+factor(Yearfactor) + s(logsouthernkingfishP915forageP915) + s(logsouthernkingfishP915forageP120), family= tw(), data=df_CPUE_length_wide_both)

blackdrum_env_forage <- gam(blackdrumP915~s(avgdepth)+s(avgssal)+s(avgstemp)+s(avgsdo)+s(NoFishRest)+factor(Yearfactor) + s(logblackdrumP915forageP120), family= tw(), data=df_CPUE_length_wide_both)
```

#### A)

```{r}
plot <- function(smooth_df, smooth2, predictor, df, predictor2, predictor3, predator, xlabel){
  smooth_df %>%
    filter(smooth == smooth2) %>% ggplot() + geom_rug(aes(x= {{predictor}}), data= df) + geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, x = {{predictor}}), alpha = 0.2) + geom_point(aes(x = {{predictor}}, y = {{predictor2}}), data = df, cex = 1.5, colour = "steelblue3")+ geom_line(aes(x = {{predictor}}, y = est), lwd = 1.2) + labs(y = "Partial effect", title = predictor3) + standard_theme + xlab(xlabel) + labs(title=NULL) + theme(axis.title.y=element_blank())
}
```

```{r}
sm <- smooth_estimates(reddrum_env_bc) %>% transform_fun(exp) %>%
add_confint() 

pr <- df %>% add_partial_residuals(reddrum_env_bc) %>%  
transform_fun(fun = exp, column = "s(avgssal)") %>%  
transform_fun(fun = exp, column = "s(avgstemp)") %>%  
transform_fun(fun = exp, column = "s(avgdepth)") %>%  
transform_fun(fun = exp, column = "s(avgsdo)") %>%  
transform_fun(fun = exp, column = "s(NoFishRest)") %>%  
transform_fun(fun = exp, column = "s(logsmallbluecrabP120)")

p1 <- plot(sm, "s(avgssal)", avgssal, pr, `s(avgssal)`, "s(avgssal)", reddrumP915, "Average surface salinity")
p2 <- plot(sm, "s(avgstemp)", avgstemp, pr, `s(avgstemp)`, "s(avgstemp)", reddrumP915, "Average surface temperature")
p3 <- plot(sm, "s(avgdepth)", avgdepth, pr, `s(avgdepth)`, "s(avgdepth)", reddrumP915, "Average depth")
p4 <- plot(sm, "s(avgsdo)", avgsdo, pr, `s(avgsdo)`, "s(avgsdo)", reddrumP915, "Average surface dissolved oxygen")
p5 <- plot(sm, "s(NoFishRest)", NoFishRest, pr, `s(NoFishRest)`, "s(NoFishRest)", reddrumP915, "NoFishRest")
p6 <- plot(sm, "s(logsmallbluecrabP120)", logsmallbluecrabP120, pr, `s(logsmallbluecrabP120)`, "s(logsmallbluecrabP120)", reddrumP915, "Small blue crab CPUE") 

t1 <- ggarrange(p1, p2, p3, p4, p5, p6)
annotate_figure(t1, left= textGrob("Partial effect", rot=90), fig.lab= "A)", top = "reddrumP915 ~ s(avgdepth)+s(avgssal)+s(avgstemp)+s(avgsdo)\n+s(NoFishRest)+factor(Yearfactor)+s(logsmallbluecrabP120)")
```

#### B)

```{r}
sm2 <- smooth_estimates(southernkingfish_env_forage) %>% transform_fun(exp) %>%
add_confint() 

pr2 <- df %>% add_partial_residuals(southernkingfish_env_forage) %>%  transform_fun(fun = exp, column = "s(avgssal)") %>%  
transform_fun(fun = exp, column = "s(avgstemp)") %>%  
transform_fun(fun = exp, column = "s(avgdepth)") %>%  
transform_fun(fun = exp, column = "s(avgsdo)") %>%  
transform_fun(fun = exp, column = "s(NoFishRest)") %>%  
transform_fun(fun = exp, column = "s(logsouthernkingfishP915forageP915)") %>%  
transform_fun(fun = exp, column = "s(logsouthernkingfishP915forageP120)")

p1 <- plot(sm2, "s(avgssal)", avgssal, pr2, `s(avgssal)`, "s(avgssal)", southernkingfishP915, "Average surface salinity")
p2 <- plot(sm2, "s(avgstemp)", avgstemp, pr2, `s(avgstemp)`, "s(avgstemp)", southernkingfishP915, "Average surface temperature")
p3 <- plot(sm2, "s(avgdepth)", avgdepth, pr2, `s(avgdepth)`, "s(avgdepth)", southernkingfishP915, "Average depth")
p4 <- plot(sm2, "s(avgsdo)", avgsdo, pr2, `s(avgsdo)`, "s(avgsdo)", southernkingfishP915, "Average surface dissolved oxygen")
p5 <- plot(sm2, "s(NoFishRest)", NoFishRest, pr2, `s(NoFishRest)`, "s(NoFishRest)", southernkingfishP915, "NoFishRest")
p6 <- plot(sm2, "s(logsouthernkingfishP915forageP915)", logsouthernkingfishP915forageP915, pr2, `s(logsouthernkingfishP915forageP915)`, "s(logsouthernkingfishP915forageP915)", southernkingfishP915, "P915 Prey CPUE") 
p7 <- plot(sm2, "s(logsouthernkingfishP915forageP120)", logsouthernkingfishP915forageP120, pr2, `s(logsouthernkingfishP915forageP120)`, "s(logsouthernkingfishP915forageP120)", southernkingfishP915, "P120 Prey CPUE") 

t2 <- ggarrange(p1, p2, p3, p4, p5, p6, p7)
annotate_figure(t2, left= textGrob("Partial effect", rot=90), fig.lab= "B)", top= "southernkingfishP915 ~ s(avgdepth)+s(avgssal)+s(avgstemp)+s(avgsdo)+s(NoFishRest)\n+factor(Yearfactor)+s(logsouthernkingfishP915forageP915)+s(logsouthernkingfishP915forageP120)")
```

#### C)

```{r}
sm3 <- smooth_estimates(blackdrum_env_forage) %>% transform_fun(exp) %>%
add_confint() 

pr3 <- df %>% add_partial_residuals(blackdrum_env_forage) %>%  transform_fun(fun = exp, column = "s(avgssal)") %>%  
transform_fun(fun = exp, column = "s(avgstemp)") %>%  
transform_fun(fun = exp, column = "s(avgdepth)") %>%  
transform_fun(fun = exp, column = "s(avgsdo)") %>%  
transform_fun(fun = exp, column = "s(NoFishRest)") %>%  
transform_fun(fun = exp, column = "s(logblackdrumP915forageP120)")

p1 <- plot(sm3, "s(avgssal)", avgssal, pr3, `s(avgssal)`, "s(avgssal)", blackdrumP915, "Average surface salinity")
p2 <- plot(sm3, "s(avgstemp)", avgstemp, pr3, `s(avgstemp)`, "s(avgstemp)", blackdrumP915, "Average surface temperature")
p3 <- plot(sm3, "s(avgdepth)", avgdepth, pr3, `s(avgdepth)`, "s(avgdepth)", blackdrumP915, "Average depth")
p4 <- plot(sm3, "s(avgsdo)", avgsdo, pr3, `s(avgsdo)`, "s(avgsdo)", blackdrumP915, "Average surface dissolved oxygen")
p5 <- plot(sm3, "s(NoFishRest)", NoFishRest, pr3, `s(NoFishRest)`, "s(NoFishRest)", blackdrumP915, "NoFishRest")
p6 <- plot(sm3, "s(logblackdrumP915forageP120)", logblackdrumP915forageP120, pr3, `s(logblackdrumP915forageP120)`, "s(logblackdrumP915forageP120)", blackdrumP915, "P120 Prey CPUE") 

t3 <- ggarrange(p1, p2, p3, p4, p5, p6)
annotate_figure(t3, left= textGrob("Partial effect", rot=90), fig.lab= "C)", top= "blackdrumP915 ~s(avgdepth)+s(avgssal)+s(avgstemp)+s(avgsdo)+s(NoFishRest)\n+factor(Yearfactor)+s(logblackdrumP915forageP120)")
```

### Fig B.4- B.5

#### Red drum

```{r}
reddrum_gam_env_bc <- reddrum_gam_env_bc %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + BC") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
reddrum_gJam_env_bc <- reddrum_gJam_env_bc %>% mutate("Model_type" = "Environment + BC") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

reddrum_gam_env_forage <- reddrum_gam_env_forage %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + prey") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
reddrum_gJam_env_forage <- reddrum_gJam_env_forage %>% mutate("Model_type" = "Environment + prey") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

reddrum_gam_env_bc_forage <- reddrum_gam_env_bc_forage %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + BC + prey") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
reddrum_gJam_env_bc_forage <- reddrum_gJam_env_bc_forage %>% mutate("Model_type" = "Environment + BC + prey") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

reddrum_B4_df <- rbind(reddrum_gam_env_bc, reddrum_gam_env_bc_forage, reddrum_gam_env_forage, reddrum_gJam_env_bc, reddrum_gJam_env_bc_forage, reddrum_gJam_env_forage)
reddrum_B4_df_r2 <- reddrum_B4_df %>% filter(Model_approach %in% c("GAM_r2", "r2_con", "r2_uncon"))
reddrum_B4_df_rmse <- reddrum_B4_df %>% filter(Model_approach %in% c("GAM_rmse", "rmse_con", "rmse_uncon"))
```

```{r}
reddrum_B4_df_r2$Model_approach <- factor(reddrum_B4_df_r2$Model_approach, levels = c("GAM_r2", "r2_uncon", "r2_con")) 
reddrum_B4_df_r2$Model_type <- factor(reddrum_B4_df_r2$Model_type, levels = c("Environment + BC", "Environment + prey", "Environment + BC + prey"))
mean_reddrum_r2 <- reddrum_B4_df_r2 %>% group_by(Model_type, Model_approach) %>%
summarize(mean_value = mean(value), .groups = 'drop')

library(ggpubr)
reddrum_r2_graph <- ggplot() + geom_boxplot(aes(x= Model_approach, y = value), data= reddrum_B4_df_r2) +  geom_point(data = mean_reddrum_r2, aes(x = Model_approach, y = mean_value), color = "red", size = 2)  +  facet_wrap(~Model_type, scales= "free") + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("R"^"2"))) + labs(tag= "A)") + theme(axis.text.x = element_text(angle = 90)) + expand_limits(y= c(0, 0.015)) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.16, label= "") + geom_bracket(xmin= 2.1, xmax=3, y.position= 0.16, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 0.21, label= "") + ylim(-0.30, 0.23) + ggtitle("Red drum") 
ggsave("/Users/sallydowd/Desktop/Graphs_edit/reddrum_r2_graph.pdf", width= 10, height= 5)

reddrum_B4_df_rmse$Model_approach <- factor(reddrum_B4_df_rmse$Model_approach, levels = c("GAM_rmse", "rmse_uncon", "rmse_con")) 
reddrum_B4_df_rmse$Model_type <- factor(reddrum_B4_df_rmse$Model_type, levels = c("Environment + BC", "Environment + prey", "Environment + BC + prey"))
mean_reddrum_rmse <- reddrum_B4_df_rmse %>% group_by(Model_type, Model_approach) %>%
summarize(mean_value = mean(value), .groups = 'drop')

reddrum_rmse_graph <-ggplot() + geom_boxplot(aes(x= Model_approach, y = value), data= reddrum_B4_df_rmse) +  geom_point(data = mean_reddrum_rmse, aes(x = Model_approach, y = mean_value), color = "red", size = 2)  +  facet_wrap(~Model_type, scales= "free") + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("RMSE"))) + labs(tag= "A)") + expand_limits(y= c(0.0015, 0.0083)) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.0072, label= "") + geom_bracket(xmin= 2.1, xmax=3, y.position= 0.0072, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 0.0080, label= "") + ggtitle("Red drum")
ggsave("/Users/sallydowd/Desktop/Graphs_edit/reddrum_rmse_graph.pdf", width= 10, height= 5)
```

#### Southern kingfish

```{r}
southernkingfish_gam_env_bc <- southernkingfish_gam_env_bc %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + BC") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
southernkingfish_gJam_env_bc <- southernkingfish_gJam_env_bc %>% mutate("Model_type" = "Environment + BC") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

southernkingfish_gam_env_forage <- southernkingfish_gam_env_forage %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + prey") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
southernkingfish_gJam_env_forage <- southernkingfish_gJam_env_forage %>% mutate("Model_type" = "Environment + prey") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

southernkingfish_gam_env_bc_forage <- southernkingfish_gam_env_bc_forage %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + BC + prey") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
southernkingfish_gJam_env_bc_forage <- southernkingfish_gJam_env_bc_forage %>% mutate("Model_type" = "Environment + BC + prey") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

southernkingfish_B4_df <- rbind(southernkingfish_gam_env_bc, southernkingfish_gam_env_bc_forage, southernkingfish_gam_env_forage, southernkingfish_gJam_env_bc, southernkingfish_gJam_env_bc_forage, southernkingfish_gJam_env_forage)
southernkingfish_B4_df_r2 <- southernkingfish_B4_df %>% filter(Model_approach %in% c("GAM_r2", "r2_con", "r2_uncon"))
southernkingfish_B4_df_rmse <- southernkingfish_B4_df %>% filter(Model_approach %in% c("GAM_rmse", "rmse_con", "rmse_uncon"))
```

```{r}
southernkingfish_B4_df_r2$Model_approach <- factor(southernkingfish_B4_df_r2$Model_approach, levels = c("GAM_r2", "r2_uncon", "r2_con")) 
southernkingfish_B4_df_r2$Model_type <- factor(southernkingfish_B4_df_r2$Model_type, levels = c("Environment + BC", "Environment + prey", "Environment + BC + prey"))
mean_southernkingfish_r2 <- southernkingfish_B4_df_r2 %>% group_by(Model_type, Model_approach) %>%
summarize(mean_value = mean(value), .groups = 'drop')

library(ggpubr)
southernkingfish_r2_graph <- ggplot() + geom_boxplot(aes(x= Model_approach, y = value), data= southernkingfish_B4_df_r2) +  geom_point(data = mean_southernkingfish_r2, aes(x = Model_approach, y = mean_value), color = "red", size = 2)  +  facet_wrap(~Model_type, scales= "free") + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("R"^"2"))) + ggtitle("Southern kingfish") + labs(tag= "B)") + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.19, label= "") + geom_bracket(xmin= 2.1, xmax=3, y.position= 0.19, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 0.21, label= "") + ylim(-0.02, 0.22) + theme(axis.text.x = element_text(angle = 90))
ggsave("/Users/sallydowd/Desktop/Graphs_edit/sk_r2_graph.pdf", width= 10, height= 5)

southernkingfish_B4_df_rmse$Model_approach <- factor(southernkingfish_B4_df_rmse$Model_approach, levels = c("GAM_rmse", "rmse_uncon", "rmse_con")) 
southernkingfish_B4_df_rmse$Model_type <- factor(southernkingfish_B4_df_rmse$Model_type, levels = c("Environment + BC", "Environment + prey", "Environment + BC + prey"))
mean_southernkingfish_rmse <- southernkingfish_B4_df_rmse %>% group_by(Model_type, Model_approach) %>%
summarize(mean_value = mean(value), .groups = 'drop')

southernkingfish_rmse_graph <-ggplot() + geom_boxplot(aes(x= Model_approach, y = value), data= southernkingfish_B4_df_rmse) +  geom_point(data = mean_southernkingfish_rmse, aes(x = Model_approach, y = mean_value), color = "red", size = 2)  +  facet_wrap(~Model_type, scales= "free") + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("RMSE"))) + labs(tag= "B)") + ggtitle("Southern kingfish") + expand_limits(y= c(0.00050, 0.00105)) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.00098, label= "") + geom_bracket(xmin= 2.1, xmax=2.93, y.position= 0.00098, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 0.001065, label= "") 
ggsave("/Users/sallydowd/Desktop/Graphs_edit/sk_rmse_graph.pdf", width= 10, height= 5)
```

#### Black drum

```{r}
blackdrum_gam_env_bc <- blackdrum_gam_env_bc %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + BC") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
blackdrum_gJam_env_bc <- blackdrum_gJam_env_bc %>% mutate("Model_type" = "Environment + BC") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

blackdrum_gam_env_forage <- blackdrum_gam_env_forage %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + prey") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
blackdrum_gJam_env_forage <- blackdrum_gJam_env_forage %>% mutate("Model_type" = "Environment + prey") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

blackdrum_gam_env_bc_forage <- blackdrum_gam_env_bc_forage %>% dplyr::select(mean_rsq, mean_rmse) %>% mutate("Model_type"= "Environment + BC + prey") %>% dplyr::rename("GAM_r2"= "mean_rsq", "GAM_rmse"= "mean_rmse") %>% pivot_longer(cols= c(GAM_r2, GAM_rmse), names_to = "Model_approach", values_to = "value")
blackdrum_gJam_env_bc_forage <- blackdrum_gJam_env_bc_forage %>% mutate("Model_type" = "Environment + BC + prey") %>% pivot_longer(cols= c(r2_con, r2_uncon, rmse_con, rmse_uncon), names_to = "Model_approach", values_to = "value") %>% dplyr::select(-X)

blackdrum_B4_df <- rbind(blackdrum_gam_env_bc, blackdrum_gam_env_bc_forage, blackdrum_gam_env_forage, blackdrum_gJam_env_bc, blackdrum_gJam_env_bc_forage, blackdrum_gJam_env_forage)
blackdrum_B4_df_r2 <- blackdrum_B4_df %>% filter(Model_approach %in% c("GAM_r2", "r2_con", "r2_uncon"))
blackdrum_B4_df_rmse <- blackdrum_B4_df %>% filter(Model_approach %in% c("GAM_rmse", "rmse_con", "rmse_uncon"))
```

```{r}
blackdrum_B4_df_r2$Model_approach <- factor(blackdrum_B4_df_r2$Model_approach, levels = c("GAM_r2", "r2_uncon", "r2_con")) 
blackdrum_B4_df_r2$Model_type <- factor(blackdrum_B4_df_r2$Model_type, levels = c("Environment + BC", "Environment + prey", "Environment + BC + prey"))
mean_blackdrum_r2 <- blackdrum_B4_df_r2 %>% group_by(Model_type, Model_approach) %>%
summarize(mean_value = mean(value), .groups = 'drop')

library(ggpubr)
blackdrum_r2_graph <-ggplot() + geom_boxplot(aes(x= Model_approach, y = value), data= blackdrum_B4_df_r2) +  geom_point(data = mean_blackdrum_r2, aes(x = Model_approach, y = mean_value), color = "red", size = 2)  +  facet_wrap(~Model_type, scales= "free") + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("R"^"2"))) + ggtitle("Black drum") + labs(tag= "C)") + theme(axis.text.x = element_text(angle = 90)) + ylim(-1.2, 0.9) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.65, label= "") + geom_bracket(xmin= 2.1, xmax=3, y.position= 0.65, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 0.83, label= "") 
ggsave("/Users/sallydowd/Desktop/Graphs_edit/bd_r2_graph.pdf", width= 10, height= 5)


blackdrum_B4_df_rmse$Model_approach <- factor(blackdrum_B4_df_rmse$Model_approach, levels = c("GAM_rmse", "rmse_uncon", "rmse_con")) 
blackdrum_B4_df_rmse$Model_type <- factor(blackdrum_B4_df_rmse$Model_type, levels = c("Environment + BC", "Environment + prey", "Environment + BC + prey"))
mean_blackdrum_rmse <- blackdrum_B4_df_rmse %>% group_by(Model_type, Model_approach) %>%
summarize(mean_value = mean(value), .groups = 'drop')

blackdrum_rmse_graph <- ggplot() + geom_boxplot(aes(x= Model_approach, y = value), data= blackdrum_B4_df_rmse) +  geom_point(data = mean_blackdrum_rmse, aes(x = Model_approach, y = mean_value), color = "red", size = 2)  +  facet_wrap(~Model_type, scales= "free") + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("RMSE"))) + labs(tag= "C)") + ggtitle("Black drum") + ylim(0.000, 0.0113) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.0095, label= "") + geom_bracket(xmin= 2.1, xmax=2.9, y.position= 0.0095, label= "") + geom_bracket(xmin= 1, xmax=2.9, y.position= 0.011, label= "") 
ggsave("/Users/sallydowd/Desktop/Graphs_edit/bd_rmse_graph.pdf", width= 10, height= 5)
```

### Fig. B.6

```{r}
#Red drum 
reddrum_model1 <- read.csv("/users/sallydowd/Desktop/reddrum_model1.csv")
reddrum_model2 <- read.csv("/users/sallydowd/Desktop/reddrum_model2.csv")
reddrum_model3 <- read.csv("/users/sallydowd/Desktop/reddrum_model3.csv")

reddrum_model1 <- reddrum_model1 %>% dplyr::select(-X) %>% mutate(Model_type = "Low")
reddrum_model2 <- reddrum_model2 %>% dplyr::select(-X) %>% mutate(Model_type = "Medium")
reddrum_model3 <- reddrum_model3 %>% dplyr::select(-X) %>% mutate(Model_type = "High")

reddrum_rmse <- rbind(reddrum_model1, reddrum_model2, reddrum_model3) %>% dplyr::select(-r2_con, -r2_uncon)
reddrum_rmse <- reddrum_rmse %>% pivot_longer(cols= c(rmse_con, rmse_uncon), names_to = "prediction_type", values_to = "value") 
reddrum_rmse$prediction_type <- factor(reddrum_rmse$prediction_type, levels = c("rmse_uncon", "rmse_con")) 
reddrum_rmse$Model_type <- factor(reddrum_rmse$Model_type, levels = c("Low", "Medium", "High"))
new_labels <- c("rmse_uncon" = "Traditional", "rmse_con" = "Conditional")
mean_reddrum_rmse <- reddrum_rmse %>% group_by(Model_type, prediction_type) %>%
summarize(mean_value = mean(value), .groups = 'drop')

fig3_rd <- ggplot() + geom_boxplot(aes(x= Model_type, y = value), data= reddrum_rmse) +  geom_point(data = mean_reddrum_rmse, aes(x = Model_type, y = mean_value), color = "red", size = 2) +  facet_wrap(~prediction_type, scales= "free", labeller= as_labeller(new_labels)) + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("RMSE"))) + labs(tag= "A)") + theme(axis.text.x = element_text(angle = 360)) + expand_limits(y= c(0, 0.015)) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.0135, label= "") + geom_bracket(xmin= 1, xmax=3, y.position= 0.0147, label= "") + geom_bracket(xmin= 2.1, xmax= 2.9, y.position= 0.0135, label= "") + ggtitle("Red drum")  + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r}
#Southern kingfish 
sk_model1 <- read.csv("/users/sallydowd/Desktop/southernkingfish_model1.csv")
sk_model2 <- read.csv("/users/sallydowd/Desktop/southernkingfish_model2.csv")
sk_model3 <- read.csv("/users/sallydowd/Desktop/southernkingfish_model3.csv")

sk_model1 <- sk_model1 %>% dplyr::select(-X) %>% mutate(Model_type = "Low")
sk_model2 <- sk_model2 %>% dplyr::select(-X) %>% mutate(Model_type = "Medium")
sk_model3 <- sk_model3 %>% dplyr::select(-X) %>% mutate(Model_type = "High")

sk_rmse <- rbind(sk_model1, sk_model2, sk_model3) %>% dplyr::select(-r2_con, -r2_uncon)
sk_rmse <- sk_rmse %>% pivot_longer(cols= c(rmse_con, rmse_uncon), names_to = "prediction_type", values_to = "value") 
sk_rmse$prediction_type <- factor(sk_rmse$prediction_type, levels = c("rmse_uncon", "rmse_con")) 
sk_rmse$Model_type <- factor(sk_rmse$Model_type, levels = c("Low", "Medium", "High"))
new_labels <- c("rmse_uncon" = "Traditional", "rmse_con" = "Conditional")
mean_sk_rmse <- sk_rmse %>% group_by(Model_type, prediction_type) %>%
summarize(mean_value = mean(value), .groups = 'drop')

fig3_sk <- ggplot() + geom_boxplot(aes(x= Model_type, y = value), data= sk_rmse) +geom_point(data = mean_sk_rmse, aes(x = Model_type, y = mean_value), color = "red", size = 2) + facet_wrap(~prediction_type, scales= "free", labeller= as_labeller(new_labels)) + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("RMSE"))) + labs(tag= "B)") + theme(axis.text.x = element_text(angle = 360)) + expand_limits(y= c(0.0004, 0.00155)) + geom_bracket(xmin= 1, xmax= 1.9, y.position= 0.00145, label= "") + geom_bracket(xmin= 1, xmax=3, y.position=0.00152, label= "") + geom_bracket(xmin= 2.1, xmax= 2.9, y.position= 0.00145, label= "") + ggtitle("Southern kingfish")  + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r}
#Black drum 
bd_model1 <- read.csv("/users/sallydowd/Desktop/blackdrum_model1.csv")
bd_model2 <- read.csv("/users/sallydowd/Desktop/blackdrum_model2.csv")
bd_model3 <- read.csv("/users/sallydowd/Desktop/blackdrum_model3.csv")

bd_model1 <- bd_model1 %>% dplyr::select(-X) %>% mutate(Model_type = "Low")
bd_model2 <- bd_model2 %>% dplyr::select(-X) %>% mutate(Model_type = "Medium")
bd_model3 <- bd_model3 %>% dplyr::select(-X) %>% mutate(Model_type = "High")

bd_rmse <- rbind(bd_model1, bd_model2, bd_model3) %>% dplyr::select(-r2_con, -r2_uncon)
bd_rmse <- bd_rmse %>% pivot_longer(cols= c(rmse_con, rmse_uncon), names_to = "prediction_type", values_to = "value") 
bd_rmse$prediction_type <- factor(bd_rmse$prediction_type, levels = c("rmse_uncon", "rmse_con")) 
bd_rmse$Model_type <- factor(bd_rmse$Model_type, levels = c("Low", "Medium", "High"))
new_labels <- c("rmse_uncon" = "Traditional", "rmse_con" = "Conditional")
mean_bd_rmse <- bd_rmse %>% group_by(Model_type, prediction_type) %>%
summarize(mean_value = mean(value), .groups = 'drop')

fig3_bd <- ggplot() + geom_boxplot(aes(x= Model_type, y = value), data= bd_rmse) +  geom_point(data = mean_bd_rmse, aes(x = Model_type, y = mean_value), color = "red", size = 2) +  facet_wrap(~prediction_type, scales= "free", labeller= as_labeller(new_labels)) + standard_theme + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Model type") + ylab(expression(paste("RMSE"))) + labs(tag= "C)") + theme(axis.text.x = element_text(angle = 360)) + expand_limits(y= c(0.0004, 0.0115)) + geom_bracket(xmin= 1.1, xmax= 1.9, y.position= 0.0098, label= "") + geom_bracket(xmin= 1.1, xmax=3, y.position=0.011, label= "") + geom_bracket(xmin= 2.1, xmax= 2.9, y.position= 0.0098, label= "") + ggtitle("Black drum")  + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r}
fig <- ggarrange(fig3_rd + rremove("xlab") + rremove("ylab"), fig3_sk + rremove("xlab") + rremove("ylab"), fig3_bd + rremove("xlab") + rremove("ylab"), ncol= 3)
library(grid)
annotate_figure(fig, bottom= textGrob("Model type"), left= textGrob(expression(paste("R"^"2")), rot= 90))
ggsave("/users/sallydowd/Desktop/Graphs_edit/figureB.6.pdf", width= 12, height= 5)
```
