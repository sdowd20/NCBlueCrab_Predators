---
title: "Length"
format: html
editor: visual
---

#### Load packages, functions, datasets

```{r}
packages <- c("ggplot2", "tidyverse", "lubridate", "sf", "sp", "dplyr", "rnaturalearth", "readr", "readxl", "spatialEco")
invisible(lapply(packages, library, character.only= TRUE))

standard_theme <- theme_bw() + theme(panel.border = element_rect(fill=NA, colour = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.text.align= 0, legend.title= element_text(size = 12), legend.text = element_text(size= 10), axis.text=element_text(size=10), axis.title=element_text(size=12))

#CPUEs 
p915_CPUE <- read_csv("/users/sallydowd/Desktop/Ch1Data/P915/p915_CPUE_new.csv")
setwd("~/Documents/GitHub/NCBlueCrab_Predators")
p120_CPUE <- read_csv("Data/P120/Finalized/p120_CPUE.csv") #98472 rows/14 species = 7053 unique sampling events 
p195_CPUE <- read_csv("Data/P195/Finalized/p195_CPUE.csv")

#Length 
p915_len_f <- read.csv("~/Desktop/Ch1Data/P915/p915_length_final.csv")
p915_len_f <- p915_len_f %>% dplyr::select(-X)
P120_bioledt <- read_csv("~/Desktop/Ch1Data/P120/p120_biol_new.csv")
p195_lengthfreq <- read_csv("~/Documents/GitHub/NCBlueCrab_Predators/Data/P195/Finalized/p195_lengthfreq.csv")
```

#### P915

```{r}
#Diagnostics 
##Compare w/ CPUE dataset
length(unique(p915_len_f$Sample)) #13611
length(unique(p915_CPUE$Sample)) #13947
length(unique(p915_len_f$Control1)) #19910
length(unique(p915_CPUE$Control1)) #13947

combo <- p915_len_f %>% dplyr::select(Speciescommonname, Colnum, Length, Sample) 
# merged_df <- merge(p915_CPUE, combo, by = "Sample")
# length(unique(merged_df$Sample)) #13611 same Samples
unmerged_df <- anti_join(p915_CPUE, combo, by = "Sample")
length(unique(unmerged_df$Sample)) #336 of different ones that aren't present in p915_len_f
diff_samples <- unique(unmerged_df$Sample)
#sample_combo <- merged_df$Sample
yep <- p915_len_f %>% filter(!Sample %in% sample_combo)
```

```{r}
#Sub-sampled data
##Test with atlantic menhaden 
tryit2 <- p915_len_f %>% filter(Speciescommonname %in% "atlantic menhaden") %>% dplyr::select(Sample, Speciescommonname, Colnum, Length, Control2, Linenum)
tryit2$Age_class <- ifelse(tryit2$Length <= 250, "J", "A") #assign age class
test2 <- tryit2 %>% group_by(Sample, Colnum, Age_class, Control2) %>% summarize(count= n()) %>% ungroup() %>% group_by(Sample, Colnum, Control2) %>% mutate(sum_count= sum(count))
test2_freq <- test2 %>% group_by(Sample, Colnum, Control2) %>% mutate(Freq= count/sum_count) %>% ungroup() %>% mutate(Number= Freq*Colnum) #counted # of observations in each age class for a sample, computed a frequency, multiplied frequency by total Colnum
test2_edt <- test2_freq %>% group_by(Sample, Age_class) %>% summarize(Num_sum = sum(Number)) #sum number of individuals in each age class, 10797 samples 

length_test <- p915_CPUE %>% filter(Speciescommonname %in% "atlantic menhaden") %>% group_by(Sample) %>% slice(rep(1:n(), each = 2)) %>% mutate(Age_class = rep(c("J", "A"), length.out = n())) #n(): for each sample observation, duplicate each row for sample one with J and one with adult
combo <- length_test %>% filter(Speciescommonname %in% "atlantic menhaden") %>% left_join(test2_edt, by= c("Sample", "Age_class"))
combo$Num_sum[combo$Num_sum %in% NA] <- 0

#Check if worked: 
##Joining 
sel_to_combo <- combo %>% filter(!Num_sum %in% NA) #10797 samples with no NA, the joining worked
length(unique(sel_to_combo$Sample))

##Create length CPUE
check <- combo %>% group_by(Sample) %>% mutate(sum_count = sum(Num_sum)) %>% distinct(sum_count, .keep_all= TRUE) %>% select(Sample, sum_count) %>% rename("Colnum"= "sum_count")
# check$Colnum <- format(check$Colnum, nsmall = 0)
with <- p915_CPUE %>% filter(Speciescommonname %in% "atlantic menhaden") %>% select(Sample, Colnum)
differences <- anti_join(check, with, by = "Sample") #0, same samples 
#unique(differences$Speciescommonname) 

combo %>% filter(Sample %in% "17117NEUSE2260.")
test2_edt %>% filter(Sample %in% "17117NEUSE2260.")
t2 <- p915_CPUE %>% filter(Sample %in% "17117NEUSE2260.", Speciescommonname %in% "atlantic menhaden")
write.csv(t2, "~/Desktop/p915_CPUE.csv")
t <- p915_len_f %>% filter(Speciescommonname %in% "atlantic menhaden", Sample %in% "17117NEUSE2260.")
write.csv(t, "~/Desktop/p915_len_f.csv")
merged_df <- inner_join(check, with, by = 'Sample')
merged_df$Colnum.x <- gsub("\\s", "", merged_df$Colnum.x)
merged_df$Colnum.y <- gsub("\\s", "", merged_df$Colnum.y)
merged_df$Colnum_match <- merged_df$Colnum.x == merged_df$Colnum.y #there are a bunch of differences
merged_df <- merged_df %>% mutate(across(c(Colnum.x, Colnum.y), as.numeric))
merged_df$diff <- merged_df$Colnum.x - merged_df$Colnum.y #300 out of 13,947 with differences, ranging from 
ggplot() + geom_histogram(data= merged_df, aes(x= diff)) + standard_theme
```

```{r}
#Form menhaden dataset 
menhaden <- p915_len_f %>% filter(Speciescommonname %in% "atlantic menhaden") %>% dplyr::select(Sample, Speciescommonname, Colnum, Length, Control2, Linenum)
##Assign age class
menhaden$Age_class <- ifelse(menhaden$Length <= 250, "J", "A") 
##Count # of individuals in an age class for a mesh size, sum_count as # of individuals in both age classes 
menhaden2 <- menhaden %>% group_by(Sample, Colnum, Age_class, Control2) %>% summarize(count= n()) %>% ungroup() %>% group_by(Sample, Colnum, Control2) %>% mutate(sum_count= sum(count))

##Counted # of observations in each age class for a sample, computed a frequency, multiplied frequency by total Colnum
menhaden2_freq <- menhaden2 %>% group_by(Sample, Colnum, Control2) %>% mutate(Freq= count/sum_count) %>% ungroup() %>% mutate(Number= Freq*Colnum) 
menhaden2_freq <- menhaden2_freq %>% group_by(Sample, Age_class) %>% summarize(Num_sum = sum(Number)) #sum number of individuals in each age class, 10797 samples 

##Make each Sample have juvenile and adult associated with it in CPUE file
length_samples <- unique(p915_len_f$Sample)
mehnaden_CPUE <- p915_CPUE %>% filter(Speciescommonname %in% "atlantic menhaden") %>% group_by(Sample) %>% slice(rep(1:n(), each = 2)) %>% mutate(Age_class = rep(c("J", "A"), length.out = n())) #n(): for each sample observation, duplicate each row for sample one with J and one with adult
combo <- mehnaden_CPUE %>% filter(Speciescommonname %in% "atlantic menhaden") %>% left_join(menhaden2_freq, by= c("Sample", "Age_class")) %>% filter(Sample %in% length_samples) #27894 --> 27222 when sample (drops 672 rows)
combo$Num_sum[combo$Num_sum %in% NA] <- 0
```

##### Divide length

```{r}
#Non-subsampled data
other_species <- p915_len_f %>% filter(Speciescommonname %in% c("atlantic croaker", "black drum", "bonnethead shark", "red drum", "sheepshead", "southern flounder", "southern kingfish", "spot", "spotted seatrout", "striped bass", "striped mullet", "atlantic menhaden")) %>% dplyr::select(Sample, Speciescommonname, Colnum, Length, Control2, Linenum)

##Assign age class: this needs to be generously refined
other_species <- other_species %>% mutate(Age_class = ifelse(Speciescommonname %in% "atlantic menhaden" & Length <= 250, "J", ifelse(Speciescommonname %in% "atlantic croaker" & Length <= 173, "J", ifelse(Speciescommonname %in% "black drum" & Length <= 400, "J", ifelse(Speciescommonname %in% "red drum" & Length <= 400, "J", ifelse(Speciescommonname %in% "sheepshead" & Length <= 250, "J", ifelse(Speciescommonname %in% "southern flounder" & Length <= 345.44, "J", ifelse(Speciescommonname %in% "southern kingfish" & Length <= 177, "J", ifelse(Speciescommonname %in% "spot" & Length <= 203.2, "J", ifelse(Speciescommonname %in% "spotted seatrout" & Length <= 260.8, "J", ifelse(Speciescommonname %in% "striped bass" & Length <= 500, "J", ifelse(Speciescommonname %in% "striped mullet" & Length <= 380, "J", "A"))))))))))))
                                
##Count # of individuals in an age class for a mesh size, sum_count as # of individuals in both age classes 
other_species2 <- other_species %>% group_by(Sample, Colnum, Age_class, Control2, Speciescommonname) %>% summarize(count= n()) %>% ungroup() %>% group_by(Sample, Colnum, Control2, Speciescommonname) %>% mutate(sum_count= sum(count)) 

##Counted # of observations in each age class for a sample, computed a frequency, multiplied frequency by total Colnum
other_species2_freq <- other_species2 %>% group_by(Sample, Colnum, Control2, Speciescommonname) %>% mutate(Freq= count/sum_count) %>% ungroup() %>% mutate(Number= Freq*Colnum) 
other_species2_freq <- other_species2_freq %>% group_by(Sample, Age_class, Speciescommonname) %>% summarize(Num_sum = sum(Number)) #sum number of individuals in each age class, 10797 samples 

##Make each Sample have juvenile and adult associated with it in CPUE file
length_samples <- unique(p915_len_f$Sample)
other_species_CPUE <- p915_CPUE %>% filter(Speciescommonname %in% c("atlantic menhaden", "atlantic croaker", "black drum", "red drum", "sheepshead", "southern flounder", "southern kingfish", "spot", "spotted seatrout", "striped bass", "striped mullet")) %>% group_by(Sample) %>% slice(rep(1:n(), each = 2)) %>% mutate(Age_class = rep(c("J", "A"), length.out = n())) #n(): for each sample observation, duplicate each row for sample one with J and one with adult

##Join together CPUE and length-frequency analysis
combo <- other_species_CPUE %>% left_join(other_species2_freq, by= c("Sample", "Age_class", "Speciescommonname"))

##Filter for true 0s only
combo %>% filter(! Sample %in% length_samples)
#7,392 rows with missing Sample IDs for length data, most of these are where Colnum= 0 (8052)
combo %>% filter(!Sample %in% length_samples & Colnum > 0)
#12 rows with Colnum = 1 or 2 
#Only remove Samples that wasn't there in length dataset has Colnum > 0, need to remove these for all species, assign everything
off_samples <- combo %>% filter(Sample %in% diff_samples & Colnum > 0)
off_samplesID <- unique(off_samples$Sample)
combo2 <- combo %>% filter(!(Sample %in% off_samplesID)) #drops 132 rows 

##Once you've established 0s are true, fill the NAs with 0
combo2$Num_sum[combo2$Num_sum %in% NA] <- 0 #dataset size of 334716 makes sense 
#once filtered CPUE dataset for species of interest, had 167363 observations, *2 (A and J) to get 334728, 334728- 334716= 12, removed 12 rows
```

##### Verification

```{r}
#Check if it worked
check <- combo2 %>% group_by(Sample, Speciescommonname) %>% mutate(sum_count = sum(Num_sum)) %>% distinct(sum_count, .keep_all= TRUE) %>% select(Sample, sum_count, Speciescommonname) %>% rename("Colnum"= "sum_count")
with <- p915_CPUE %>% filter(Speciescommonname %in% c("atlantic menhaden", "atlantic croaker", "black drum", "red drum", "sheepshead", "southern flounder", "southern kingfish", "spot", "spotted seatrout", "striped bass", "striped mullet")) %>% select(Sample, Colnum, Speciescommonname)
differences <- anti_join(check, with, by = c("Sample")) #0 differences in Sample (same samples), this is b/c you joined datasets and dealt w/ different samples already

check$Sample <- trimws(check$Sample)
check$Speciescommonname <- trimws(check$Speciescommonname)
check$Colnum <- trimws(check$Colnum)
with$Sample <- trimws(with$Sample)
with$Speciescommonname <- trimws(with$Speciescommonname)
with$Colnum <- trimws(with$Colnum) #remove white space 

merged_df <- inner_join(check, with, by = c('Sample', "Speciescommonname"))
merged_df$Colnum.x <- gsub("\\s", "", merged_df$Colnum.x)
merged_df$Colnum.y <- gsub("\\s", "", merged_df$Colnum.y)
merged_df$Colnum_match <- merged_df$Colnum.x == merged_df$Colnum.y #there are a bunch of differences
merged_df <- merged_df %>% mutate(across(c(Colnum.x, Colnum.y), as.numeric))
merged_df$diff <- merged_df$Colnum.x - merged_df$Colnum.y

#Number of sampling events by Species with different values 
length_diff <- merged_df %>% group_by(Speciescommonname) %>% filter(!diff %in% 0) %>% summarize(count= n())
write.csv(length_diff, "~/Desktop/length_diff.csv")

#Magnitude of difference by species 
merged_df %>% group_by(Speciescommonname) %>% filter(!diff %in% 0) %>% ggplot() + geom_histogram(aes(x= diff)) + facet_wrap(~Speciescommonname)
merged_df %>% ungroup() %>% filter(!diff %in% 0) %>% distinct(Sample) %>% summarize(count= n())

#Mean difference for species
mean_diff <- merged_df %>% group_by(Speciescommonname) %>% filter(!diff %in% 0) %>% summarize(mean_diff= mean(diff))
```

#### Final dataset formation

```{r}
#combo2 is length dataset only with species in length dataset, need to relabel species here as juvenile and adult 
length(unique(combo2$Sample))
length(unique(combo2$Speciescommonname)) #11 species, 2 age classes, 13947 Samples, 11*2*13947= 306822, number of rows

combo2_edt <- combo2 %>% mutate(Speciescommonname = ifelse(Age_class == "J", paste("juvenile", Speciescommonname), paste("adult", Speciescommonname))) %>% select(-c(Colnum, Age_class)) %>% rename("Colnum"= "Num_sum")

#Check to see if same # of Sample IDs for P915 and length dataset
p915_no_length <- p915_CPUE %>% filter(!Speciescommonname %in% other_species, !Sample %in% off_samplesID) #remove those Sample IDs that were not true 0s, drops 222 rows 

length(unique(p915_no_length$Sample)) #13941 
length(unique(combo2_edt$Sample)) #13941       
test <- rbind(p915_no_length, combo2_edt)

#Did this work? 
length(unique(test$Sample)) #13941
length(unique(test$Speciescommonname)) #59
#59*13941= 822519, # of rows in this dataset 
```

### P120

##### Blue crabs

```{r}
#Form blue crab dataset and make sure each blue crab in the subsample has their own row
P120_bc <- P120_bioledt %>% filter(Speciescommonname %in% "blue crab") %>% dplyr::select(Control1, Date, Location, Colnum, Samnum, Subnum, Linenum, Frequenc, Length, Speciescommonname) %>% drop_na(Colnum, Length)
P120_bc_edt <- P120_bc %>% group_by(Control1, Colnum, Length) %>% uncount(weights=Frequenc, .remove= FALSE) %>% mutate(Frequenc_new = 1) #duplicates rows according to Frequency 
#Bin length: define the breaks for the intervals
values <- 1:300
breaks <- seq(0, 300, by = 10)
assigned_values <- seq(10, 300, by = 10)
result <- cut(values, breaks, labels = assigned_values) #cut values based on cut points (breaks), labels for resulting category, default is (a, b)
result_numeric <- as.numeric(as.character(result))
df <- data.frame(Length = values, Assigned_length = result_numeric)

#Calculate proportion of juveniles and adults in each Eventname
P120_bc_prop <- P120_bc_edt %>% left_join(df, by= "Length")
P120_bc_prop$Age_class <- ifelse(P120_bc_prop$Assigned_length < 50, "J", "A") #assign juvenile if under 50 mm, 50.8 mm (2 inches) is harvestable length, blue crabs should reach this length in ~1 year when they become sexually mature
P120_bc_prop <- P120_bc_prop %>% group_by(Control1, Age_class, Colnum) %>% mutate(Count= n()) %>% distinct(Count, .keep_all= TRUE) %>% ungroup() %>% group_by(Control1, Colnum) %>% mutate(Total_sampled= sum(Count)) %>% ungroup() %>% mutate(Proportion= Count/Total_sampled) %>% dplyr::select(Control1, Date, Speciescommonname, Colnum, Age_class, Count, Total_sampled, Proportion) #don't need to group_by Date/Location/Station here as blue crabs weren't in the diff_values below after 2008

#Now apply proportion to Colnum 
P120_bc_prop <- P120_bc_prop %>% mutate(Number= round(Colnum*Proportion,0)) %>% group_by(Control1, Age_class) %>% mutate(Number_new = sum(Number)) %>% distinct(Number_new) #this is an important change: sometimes there were multiple Colnums for one sample, processed them differently but in the end added the numbers up from same age class 
P120_bc_prop$Number_new[P120_bc_prop$Number_new==0] <- 0.5 #Will have to check over this move, want it to be sampled but 
```

##### All species

```{r}
#Deal with length 
P120_other_species <- P120_bioledt %>% filter(Speciescommonname %in% c("atlantic menhaden", "atlantic croaker", "blue crab", "southern flounder", "spot", "spotted seatrout")) %>% dplyr::select(Control1, Date, Location, Colnum, Samnum, Subnum, Linenum, Frequenc, Length, Speciescommonname) %>% drop_na(Colnum, Length) #Length-frequency excel shows justification 

P120_other_species_edt <- P120_other_species %>% group_by(Control1, Colnum, Length, Speciescommonname) %>% uncount(weights=Frequenc, .remove= FALSE) %>% mutate(Frequenc_new = 1) #duplicates rows according to Frequency

#assign length 
P120_other_species_edt <- P120_other_species_edt %>% mutate(Age_class = ifelse(Speciescommonname %in% "atlantic menhaden" & Length <= 250, "J", ifelse(Speciescommonname %in% "atlantic croaker" & Length <= 173, "J", ifelse(Speciescommonname %in% "blue crab" & Length <= 50, "J", ifelse(Speciescommonname %in% "southern flounder" & Length <= 345.44, "J", ifelse(Speciescommonname %in% "spot" & Length <= 203.2, "J", ifelse(Speciescommonname %in% "spotted seatrout" & Length <= 260.8, "J", "A")))))))

P120_os_prop <- P120_other_species_edt %>% group_by(Control1, Age_class, Colnum, Speciescommonname) %>% mutate(Count= n()) %>% distinct(Count, .keep_all= TRUE) %>% ungroup() %>% group_by(Control1, Colnum, Speciescommonname) %>% mutate(Total_sampled= sum(Count)) %>% ungroup() %>% mutate(Proportion= Count/Total_sampled) %>% dplyr::select(Control1, Date, Speciescommonname, Colnum, Age_class, Count, Total_sampled, Proportion) #don't need to group_by Date/Location/Station here as blue crabs weren't in the diff_values below after 2008

#Now apply proportion to Colnum 
P120_os_prop <- P120_os_prop %>% mutate(Number= Colnum*Proportion) %>% group_by(Control1, Age_class, Speciescommonname) %>% mutate(Number_new = sum(Number)) %>% distinct(Number_new) #this is an important change: sometimes there were multiple Colnums for one sample, processed them differently but in the end added the numbers up from same age class 

#Combine age class and Speciescommonname
P120_os_prop_edt <- P120_os_prop %>% mutate(Speciescommonname = ifelse(Age_class == "J", paste("juvenile", Speciescommonname), paste("adult", Speciescommonname))) 

#Checking: this shows that we don't have one Control1 for each juvenile and adult of each species 
length(unique(P120_os_prop$Control1)) #9364
unique(P120_os_prop$Speciescommonname) #6
#6*9364 doesn't equal number of rows, haven't labeled J and A yet, haven't created one row for each sampling event for a species and an age class
```

```{r}
#Create CPUE dataset with length data 
##These need to be species not in length dataset 
select_spp <- c("bay anchovy", "brown shrimp", "pink shrimp", "white shrimp", "pinfish", "silver perch", "striped anchovy", "weakfish")

##Form a haul dataset where every row is one haul 
summary(is.na(P120_bioledt$Sciname)) #10 NAs for Sciname
P120_bioledt <- P120_bioledt %>% drop_na(Sciname)
P120_bioledt$Speciescommonname[P120_bioledt$Speciescommonname == "northern brown shrimp"] <- "brown shrimp"
haul <- P120_bioledt %>% group_by(Date, Location, Station, Control1) %>% mutate(ID=row_number()) %>% filter(ID==1) %>% as.data.frame() #row every haul: Dan suggested grouping by Date, Location, Control1 Station b/c location is waterbody at large and some stations have the same name (need Location), needed to exclude any non-core sampling, had to group by Control1, SPB1 was pulled twice on 11/9/2021
length(unique(haul$Control1)) #7053
length(unique(P120_bioledt$Control1)) #7053

##Create dummy column for species of focus
haul$Species=NA#create a dummy column first
haul$Species=rep_along(haul$Species, c("atlantic menhaden", "atlantic croaker", "bay anchovy", "blue crab", "brown shrimp", "pink shrimp", "white shrimp", "pinfish", "silver perch", "southern flounder", "spot", "spotted seatrout", "striped anchovy", "weakfish")) #this repeats these species common names for the entirety of the length of the haul df
haul_df <- haul %>% dplyr::select(Control1, Program, Year, Month, Day, Date, Location, Nbrrec3, Station, Time, Duration, Sedsize, Btmcomp, Sedsize_new, Btmcomp_new, Depth, Stemp, Btemp, Ssal, Bsal, Sdo, Bdo, Secchi, Latitude, Longitude, Core, Species)
haul_df_all <- haul_df %>% tidyr::expand(Species,Control1) ##using expand to make all species associated with each collection number, is 13x (# of species) larger so it worked
haul=haul_df %>% dplyr::select(-Species) #drop dummy species common name from hauldf

#now can merge haul.all and haul to create a df with a row for species associated with each collection number
haul_final=left_join(haul_df_all,haul,by="Control1")%>%as.data.frame()

#Factor in length 
sel_spp_120 <- P120_bioledt %>% filter(Speciescommonname %in% select_spp) %>% dplyr::select(Control1,Date,Speciescommonname,Colnum) 

P120_os_prop_edt


P120_bc_tojoin <- P120_bc_prop %>% dplyr::select(Control1, Date, -Speciescommonname, Age_class, Number)
P120_bc_tojoin <- P120_bc_tojoin %>% mutate(Age_class= ifelse(Age_class %in% "J", "juv blue crab", "adult blue crab")) %>% rename("Speciescommonname"= "Age_class", "Colnum"= "Number")
sel_spp_120join <- rbind(sel_spp_120, P120_bc_tojoin)
sel_spp_120joinedt <- sel_spp_120join %>% group_by(Speciescommonname,Control1)%>% mutate(id=row_number()) %>% filter(id==1) %>%ungroup()%>%as.data.frame() #should always be 1 for juv. and adult blue crab b/c have distinct rows, take the first row as there are repeats of Colnum with Control1 and Speciescommonname b/c of length measurements

#Need to remove species then! 

sel_spp_120joinedt = sel_spp_120joinedt %>% select(-id)
haul_final <- haul_final %>% rename("Speciescommonname" = "Species")
haul_sel_spp <- left_join(haul_final, sel_spp_120joinedt) %>% as.data.frame() #df is 56,424 rows, 7053 rows for each species (8 species)
haul_sel_spp$Colnum[haul_sel_spp$Colnum %in% NA] <- 0

names_join <- P120_bioledt %>% select(Speciescommonname, Sciname) %>% distinct(Speciescommonname, .keep_all= T)
p120_CPUE <- haul_sel_spp %>% left_join(names_join) %>% mutate(Sciname = ifelse(Speciescommonname == "brown shrimp", "F. aztecus", Sciname)) #brown shrimp went to NA for Sciname
p120_CPUE$Sciname <- ifelse(p120_CPUE$Speciescommonname %in% "juv blue crab"|p120_CPUE$Speciescommonname %in% "adult blue crab", "C. sapidus", p120_CPUE$Sciname)

p120_CPUE$doy <- yday(p120_CPUE$Date)
p120_CPUE$Photoperiod <- daylength(lat= p120_CPUE$Latitude, doy= p120_CPUE$doy)
p120_CPUE$Season <- ifelse(p120_CPUE$Month==4 | p120_CPUE$Month==5 | p120_CPUE$Month==6, "Spring", ifelse(p120_CPUE$Month==9 |p120_CPUE$Month==10 | p120_CPUE$Month==11 | p120_CPUE$Month==12, "Fall", ifelse(p120_CPUE$Month==7 |p120_CPUE$Month==8, "Summer", "Winter")))
p120_CPUE$Ym_date <- format(p120_CPUE$Date, "%Y-%m")

```
