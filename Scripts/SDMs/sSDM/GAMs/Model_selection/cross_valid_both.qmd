---
title: "cross_valid_both"
format: html
editor: visual
---

```{r}
source("~/Documents/GitHub/NCBlueCrab_Predators/Scripts/Load.SDM.R")

#Train and test dataset
##P915, P120 
sample_size_both = floor(0.8*nrow(df_count_wide_both))
picked_both = sample(seq_len(nrow(df_count_wide_both)),size = sample_size_both) 
df_count_wide_both_test = df_count_wide_both[-picked_both,]
df_count_wide_both_train = df_count_wide_both[picked_both,]
```

```{r}
#Load cross-validation functions 
library(gtools)

pastePerm<- function(row, names){
  keep<- which(row==1)
  if(length(keep)==0){
    return('1')
  }else{
    return(paste(names[keep],collapse='+'))
  }
}
my_sqrt <- function(var1){
  sqrt(var1) #take square root of variable 
} #construct model formulas 

dredgeform<- function(pred, covars, alwaysIn=''){ #always in is set to empty string
  p<- length(covars) #number of independent variables
  perm.tab<- permutations(2, p, v=c(0,1), repeats.allowed=T) #for different combinations of predictor variables
  myforms<- NULL #store formulas 
  for(j in 1:nrow(perm.tab)){
    myforms[j]<- pastePerm(perm.tab[j,], covars) #function above
  }
  myforms<- paste0(pred, '~',myforms) #predicted variable and formula
  return(myforms)
}
```

### P915, P120 GAMs
#### Formulas

```{r}
#Load formulas
##Red drum
allformulas_reddrum <- dredgeform(pred = "reddrum", covars = c("s(avgdepth)", "s(avgssal)", "s(avgstemp)", "s(avgsdo)", "s(SAVkm)", "s(InletDistkm)", "s(NoFishRest)", "s(atlanticmenhadenP915)", "s(atlanticcroakerP915)", "s(spotP915)", "s(blackdrumP915)", "s(pinfishP915)", "s(atlanticcroakerP120)", "s(atlanticmenhadenP120)", "s(pinfishP120)", "s(spotP120)", "s(bluecrabP120)", "s(whiteshrimpP120)", "s(pinkshrimpP120)", "s(brownshrimpP120)", "s(southernflounderP120)", "s(weakfishP120)", "s(reddrumforage)", "factor(FishingAllnum)", "factor(Sedsizecommon)"))

##Black drum
allformulas_blackdrum <- dredgeform(pred = "blackdrum", covars = c("s(avgdepth)", "s(avgssal)", "s(avgstemp)", "s(avgsdo)", "s(SAVkm)", "s(InletDistkm)", "s(NoFishRest)", "s(reddrumP915)", "s(blackdrumP915forage)", "s(bluecrabP120)", "s(whiteshrimpP120)", "s(pinkshrimpP120)", "s(brownshrimpP120)", "factor(FishingAllnum)", "factor(Sedsizecommon)"))

##Southern kingfish
allformulas_southernkingfish <- dredgeform(pred = "southernkingfish", covars = c("s(avgdepth)", "s(avgssal)", "s(avgstemp)", "s(avgsdo)", "s(SAVkm)", "s(InletDistkm)", "s(NoFishRest)", "s(atlanticmenhadenP915)", "s(atlanticcroakerP915)", "s(spotP915)", "s(southernkingfishforageP915)", "s(atlanticmenhadenP120)", "s(atlanticcroakerP120)", "s(spotP120)", "s(bluecrabP120)", "s(whiteshrimpP120)", "s(pinkshrimpP120)", "s(brownshrimpP120)", "factor(FishingAllnum)", "factor(Sedsizecommon)"))

##Bonnethead shark 
allformulas_bonnetheadshark <- dredgeform(pred = "bonnetheadshark", covars = c("s(avgdepth)", "s(avgssal)", "s(avgstemp)", "s(avgsdo)", "s(SAVkm)", "s(InletDistkm)", "s(NoFishRest)", "s(bonnetheadsharkP915forage)", "s(bluecrabP120)", "s(whiteshrimpP120)", "s(pinkshrimpP120)", "s(brownshrimpP120)", "s(NoFishRest)", "factor(FishingAllnum)", "factor(Sedsizecommon)"))
```

```{r}
#Look at correlations 
cor <- cor(df_count_wide_both[, c(14:17, 20, 22:25, 29:33, 35:40, 43:44, 46:49)])
cor_plot <- corrplot(cor)
png(file= "~/Desktop/cor_plot.png")
corrplot(cor)
dev.off()
##correlations b/w forage and brown shrimp
```

```{r}

##Bonnethead shark
compare_var_tw_bonnetheadshark <- as.data.frame(matrix(ncol = 2, nrow = 0))
colnames(compare_var_tw_bonnetheadshark) <- c("formula", "AIC")
for (i in 1:length(allformulas_bonnetheadshark)) {
model_tw_bonnetheadshark <- gam(as.formula(allformulas_bonnetheadshark[i]), family= tw(link= "log"), data=df_count_wide_both_train)
compare_var_tw_bonnetheadshark[i, 1] <- allformulas_bonnetheadshark[i]
compare_var_tw_bonnetheadshark[i, 2] <- AIC(model_tw_bonnetheadshark)
}

write.csv(compare_var_tw_bonnetheadshark_both, "~/Desktop/compare_var_tw_bonnetheadshark.csv")
```

