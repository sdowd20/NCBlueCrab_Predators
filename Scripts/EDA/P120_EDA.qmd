---
title: "P120_EDA"
format: html
editor: visual
---

#### Overall data set description

Sampling for the P120 Nursery Area Juvenile Survey began in 1971. Major gear changes and standardization occured in 1978 and 1989. Sampling has been consistent in May and June (mid two weeks) throughout the sampling period. July sampled was dropped in 1998 and then reinstituded in 2004 to produce a better index for spotted seatrout. In 2008, additional habitat fields were added. There are 104 core stations sampled each year (can't be discontinued) for juvenile abundance indices. Stations sampled in addition to the 104 are selected for various purposes. Some seagrass beds along OBX are sampled May through September. The tows are one minute in duration to span 75 yards. The historical time varied (5 minutes for 20 foot net). From what I can tell, it is just one tow at each station.

Beginning in 2008 additional data parameters for Habitat were recorded: Distance to Shoreline, Shoreline/ Shoreline Structure Type, Percent Shoreline Hardened, Land Use, and Percent Cover. If distances from shore are greater than a 550 yd radius, then code as 9s. The habitat data was piloted in 2008 and additional changes were made for 2009. Bottom composition, qualitative sediment size, secchi depth, water level, water depth, water temperatures (surface and bottom), salinities (surface and bottom), and dissolved oxygen (surface and bottom) should be collected each time a station is sampled. Grass density is characterized.

All species are identified and counted. Economically important species are counted and a random subsample of 30-60 individuals of each size group are measured (mm). Blue crabs less then 20 mm are not sexed and crabs should be measured on their backs. Blue crabs are subsampled if there are more than 30 individuals that are less than 20 mm. Larger blue crabs, ones that that are greater or equal to 20 mm are sexed and all of these are measured. For other fish, if there are two different size groups and they are subsampled separately. If there are two different size groups, SpStatus will reflect this. SpStatus= 1 is for the larger size group and SpStatus= 2 is for the smaller size group (SpStatus= 0 means fish are measured as single unit). Each column is a separate species sample from a tow. To get every tow you can group by Date and Location and get an ID for the tow (id= row_number()) in order to have a row for every haul. When the Colnum is the same for a date, location, and species, there was subsampling of the species to obtain a length.

Based on the dataset description, I am going to filter P120 to start after 1989. Also, whenever you use the dataset, make sure to remove the leading 0 from location (from 2010 to 2019 dataset).

### EDA

```{r}
##Load packages and functions 
packages <- c("ggplot2", "tidyverse", "lubridate", "sf", "sp", "dplyr", "rnaturalearth", "readr", "readxl", "spatialEco")

invisible(lapply(packages, library, character.only= TRUE))

standard_theme <- theme_bw() + theme(panel.border = element_rect(fill=NA, colour = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.text.align= 0, legend.title= element_text(size = 12), legend.text = element_text(size= 10), axis.text=element_text(size=10), axis.title=element_text(size=12))

world <- ne_countries(scale = "medium", returnclass = "sf")

##Load and edit data set
setwd("~/Desktop")
P120_biol <- read_csv("p120_biol_new.csv")
P120_biol$Year <- as.numeric(P120_biol$Year)
P120_biol <- P120_biol %>% arrange(Year)
P120_bioledt <- P120_biol %>% filter(Year > 1988)
P120_bioledt$Season <- ifelse(P120_bioledt$Month==4 | P120_bioledt$Month==5 | P120_bioledt$Month==6, "Spring", ifelse(P120_bioledt$Month==9 |P120_bioledt$Month==10 | P120_bioledt$Month==11 | P120_bioledt$Month==12, "Fall", ifelse(P120_bioledt$Month==7 |P120_bioledt$Month==8, "Summer", "Winter")))
P120_bioledt$Ym_date <- format(P120_bioledt$Date, "%Y-%m")

coords_captured <- function(species){
ggplot(data = world) + geom_sf() + geom_point(data = subset(p915_CPUEold, p915_CPUEold$Species %in% species & as.numeric(p915_CPUEold$Colnum > 0)), aes(x = as.numeric(Longitude), y = as.numeric(Latitude), colour = Colnum)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") + ggtitle(species)
}
```

#### General

```{r}
summary(is.na(P120_bioledt)) #NAs present in Grid, Quad, Time, environmental variables, Colnum, biological variables, Speciesscientificname
summary(is.na(subset(P120_bioledt, Year > 2008))) #less NAs in environmental variables after 2008

#Spatial orientation
##All stations
ggplot(data = world) + geom_sf() + geom_point(data = P120_bioledt, aes(x = as.numeric(Long_dd), y = as.numeric(Lat_dd), colour = Colnum)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") #CPUE

##Core stations
ggplot(data = world) + geom_sf() + geom_point(data = P120_bioledt, aes(x = as.numeric(Long_dd), y = as.numeric(Lat_dd), colour = Colnum)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") #CPUE

###Cores are 0, 1, 2, and 3: 1 and 2 are the 104 core stations sampled every year 
length(unique(P120_bioledt$Station)) #104 stations
core <- P120_bioledt %>% filter(Core == 1| Core == 2)
length(unique(core$Station)) #still 104 stations
notcore <- P120_bioledt %>% filter(Core == 3)

ggplot(data = world) + geom_sf() + geom_point(data = subset(P120_bioledt, Core==3), aes(x = as.numeric(Long_dd), y = as.numeric(Lat_dd), colour = Colnum)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") #CPUE
#core 0 looks the same as 1 or 2, core 3 has only 35 stations 

ggplot(data = world) + geom_sf() + geom_point(data = subset(P120_bioledt, Core==0), aes(x = as.numeric(Long_dd), y = as.numeric(Lat_dd), colour = Colnum)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") #CPUE

nrow(P120_bioledt %>% filter(Core== 0) %>% group_by(Date,Location) %>% mutate(id=cur_group_id()) %>% distinct(id)) #2304 samples
P120_bioledt %>% filter(Core== 0) %>% select(Month) %>% distinct(Month) #all months
nrow(P120_bioledt %>% filter(Core== 1) %>% group_by(Date,Location) %>% mutate(id=cur_group_id()) %>% distinct(id)) #7725 samples
P120_bioledt %>% filter(Core== 1) %>% select(Month) %>% distinct(Month) #5, 6 
nrow(P120_bioledt %>% filter(Core== 2) %>% group_by(Date,Location) %>% mutate(id=cur_group_id()) %>% distinct(id)) #737 samples
P120_bioledt %>% filter(Core== 2) %>% select(Month) %>% distinct(Month) #5, 6 
nrow(P120_bioledt %>% filter(Core== 3) %>% group_by(Date,Location) %>% mutate(id=cur_group_id()) %>% distinct(id)) #854 samples
P120_bioledt %>% filter(Core== 3) %>% select(Month) %>% distinct(Month) #7

#Sampling effort: general
ggplot() + geom_histogram(data = P120_bioledt, stat="count", aes(x=Ym_date)) + standard_theme #sampling picked up in 2008, I wonder why- just added more habitat fields here
ggplot() + geom_histogram(data = P120_bioledt, stat="count", aes(x=Ym_date)) + standard_theme + facet_wrap(~Core) #more sampling in core = 1 throughout the years 
ggplot() + geom_histogram(data = P120_bioledt, stat="count", aes(x=Year)) + standard_theme #more sampling in core = 1 throughout the years 

P120_bioledt %>% group_by(Date, Lat_dd, Long_dd) %>% summarize(abundance= mean(Colnum)) %>% ggplot() + geom_point(aes(x= Date, y= abundance)) + standard_theme #sum outliers with mean abundance to correct for

ggplot(data = world) + geom_sf() + geom_point(data = subset(core, between(Year, 2008, 2020)), aes(x = as.numeric(Long_dd), y = as.numeric(Lat_dd))) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude") 

ggplot(data = world) + geom_sf() + geom_point(data = subset(core, between(Year, 1989, 2007)), aes(x = as.numeric(Long_dd), y = as.numeric(Lat_dd))) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude")
```

There are a good amount of NAs in the dataset particularly with environmental variables. We might want to start analyzing the data in 2008 (or 2009?) when more of those habitat variables were included.

EDA revealed differences in sampling with consistency until 2010 and then a large increase in sampling in 2010 that didn't drop until 2020. That being said, the same stations were sampled throughout the years. I am unsure why.

Both core 0 and core 3 seem to sample a subset of stations of core 1 and 2 (near river and OBX vs. near river). Core 0 sampling occurs July- November and core 3 sampling is in July. There are 2304 samples for core 0, 7725 for core 1, 737 for core 2, and 854 for core 3. Core 3 only has 19 stations. Core station 1 and 0 have been consistently sampled. Core station 2 and 3 have had dips in sampling.Synopsis on cores: The inclusion/exclusion of cores will depend on the question. Will need to reconsider as the analysis carries on.

#### Species specific: spatial and temporal

```{r}
coords_captured <- function(species){
ggplot(data = world) + geom_sf() + geom_point(data = subset(P120_bioledt, P120_bioledt$Speciescommonname %in% species & as.numeric(P120_bioledt$Colnum > 0)), aes(x = as.numeric(Long_dd), y = as.numeric(Lat_dd), colour = Colnum)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") + ggtitle(species)
}

ggplot(data = world) + geom_sf() + geom_point(data = P120_bioledt, aes(x = as.numeric(Long_dd), y = as.numeric(Lat_dd))) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude")
coords_captured("northern brown shrimp")
coords_captured("bluefish")
coords_captured("atlantic croaker")
coords_captured("southern flounder")
coords_captured("red drum")
coords_captured("black drum")
coords_captured("blue catfish")
coords_captured("gizzard shad")
coords_captured("american shad")
coords_captured("cownose ray")
coords_captured("blue crab")

#Depth distribution for species
t <- P120_bioledt %>% drop_na(Depth)
min(t$Depth) #0.1 m 
max(t$Depth) #9.9 m

#Temporal: for P915 you know it's not a function of sampling since they sample year around
interest_spp <- c("northern brown shrimp", "bluefish", "atlantic croaker", "southern flounder", "red drum", "black drum", "blue catfish", "gizzard shad", "american shad", "cownose ray", "blue crab", "atlantic menhaden", "spot", "summer flounder", "shads", "american eel")
fine <- P120_bioledt %>% filter(Speciescommonname %in% interest_spp) #species of interest
ggplot() + geom_histogram(data = subset(fine, fine$Colnum > 0), stat="count", aes(x=Season)) + standard_theme + facet_wrap(~Speciescommonname)

#Number of observations for species of interest
test <- fine %>% group_by(Speciescommonname) %>% drop_na(Colnum) %>% summarise(sum_colnum= sum(Colnum)) #atlantic croaker, atlantic menhaden, blue crab, bluefish, northern brown shrimp, southern flounder, spot, and summer flounder have the most data 
```

#### Exploring length

```{r}
colnames(P120_bioledt)

P120_bioledt %>% filter(Speciescommonname %in% interest_spp) %>% drop_na(Length) %>% group_by(Speciescommonname) %>% summarise(min_l= min(Length*0.0393701), max_l= max(Length*0.0393701), mean_l = mean(Length*0.0393701), sd_l= sd(Length*0.0393701))

P120_bioledt %>% filter(Speciescommonname %in% interest_spp) %>% drop_na(Length) %>% group_by(Speciescommonname) %>% ggplot() + geom_histogram(aes(x= Length*0.0393701)) + facet_wrap(~Speciescommonname, scale= "free") + xlab("Length (in)") + ylab("Count") + standard_theme

length(unique(P120_bioledt$Control1))
length(unique(P120_bioledt$Location))
length(unique(P120_bioledt$Station))
```

#### CPUE

```{r}
#Combining datasets
##Explore species counts 
speciescount <- P120_bioledt %>% group_by(Speciescommonname, Date, Location) %>% drop_na(Colnum) %>% distinct(Colnum) %>% ungroup() %>% group_by(Speciescommonname) %>% summarise(sum_colnum= sum(Colnum)) %>% filter(Speciescommonname %in% c("brown shrimp", "bluefish", "atlantic croaker", "southern flounder", "red drum", "black drum", "blue catfish", "gizzard shad", "american shad", "atlantic thread herring", "cownose ray", "blue crab"))
#Remove cownose ray, Atlantic thread herring, and black drum b/c n < 100
select_spp <- c("brown shrimp", "bluefish", "atlantic croaker", "southern flounder", "red drum", "blue catfish", "gizzard shad", "american shad", "blue crab")

P120_bioledt$Location <- as.numeric(P120_bioledt$Location) #removes leading zeros, 101 locations is the same in old processed data (p120_clean_2021) 
length(unique(P120_bioledt$Location))

##Form a haul dataset where every row is one haul 
summary(is.na(P120_bioledt$Sciname)) #28 NAs for Sciname
P120_bioledt <- P120_bioledt %>% drop_na(Sciname)
length(unique(P120_bioledt$Control1)) #full dataset has more unique control1 than haul, 9641 vs. 9330, doesn't have to do with just selecting cores 
haul <- P120_bioledt %>% group_by(Date, Location) %>% mutate(ID=row_number()) %>% filter(ID==1) %>% as.data.frame() #row every haul (9310 variables whereas Lela had 8099), for all species
length(unique(haul$Control1))
#Let's look at which values are different: there are ~20 not in main cores, 311 values that are different--> need to ask about this 
diff_values <- setdiff(P120_bioledt$Control1, haul$Control1)

##Create dummy column for species of focus
haul$Species=NA#create a dummy column first
haul$Species=rep_along(haul$Species,c("brown shrimp", "bluefish", "atlantic croaker", "southern flounder", "red drum", "blue catfish", "gizzard shad", "american shad", "blue crab")) #this repeats these species common names for the entirety of the length of the haul df
haul_df <- haul %>% dplyr::select(Control1, Program, Year, Month, Day, Date, Location, Nbrrec3, Station, Time, Duration, Sedsize, Depth, Stemp, Btemp, Ssal, Bsal, Sdo, Bdo, Lat_dd, Long_dd, Core, Species)
haul_df_all <- haul_df %>% tidyr::expand(Species,Control1) ##using expand to make all species associated with each collection number, is 9x (# of species) larger so it worked
haul=haul_df %>%select(-Species) #drop dummy species common name from hauldf

#now can merge haul.all and haul to create a df with a row for species associated with each collection number
haul_final=left_join(haul_df_all,haul,by="Control1")%>%as.data.frame()

sel_spp_120 <- P120_bioledt %>% filter(Speciescommonname %in% select_spp) %>% select(-Frequenc,-Length,-Sex,-Maturity,-Lat_dd,-Long_dd) %>% group_by(Speciescommonname,Control1)%>% mutate(id=row_number()) %>% filter(id==1) %>%ungroup()%>%as.data.frame()

sel_spp_120edt = sel_spp_120 %>% select(Control1,Date,Speciescommonname,Colnum)

haul_final <- haul_final %>% rename("Speciescommonname" = "Species")
haul_sel_spp <- left_join(haul_final, sel_spp_120edt) %>% as.data.frame()
haul_sel_spp$Colnum[haul_sel_spp$Colnum %in% NA] <- 0

p120_CPUE <- haul_sel_spp 
p120_CPUE$Season <- ifelse(p120_CPUE$Month==4 | p120_CPUE$Month==5 | p120_CPUE$Month==6, "Spring", ifelse(p120_CPUE$Month==9 |p120_CPUE$Month==10 | p120_CPUE$Month==11 | p120_CPUE$Month==12, "Fall", ifelse(p120_CPUE$Month==7 |p120_CPUE$Month==8, "Summer", "Winter")))
p120_CPUE$Date <- as.Date(p120_CPUE$Date, "%Y-%m-%d")
p120_CPUE$Ym_date <- format(p120_CPUE$Date, "%Y-%m")

write.csv(haul_sel_spp, "~/Documents/GitHub/NCBlueCrab_Predators/Data/P120/Finalized/p120_CPUE.csv")
```

```{r}
#CPUE calculation from Lela
p120_core <- p120_df %>% filter(core==1|core==2) #Select only core stations

head(p120_core)

summary(p120_core$control1)
p120_core$control1 <- as.factor(p120_core$control1)
levels(p120_core$control1)

#Create df of every tow done to account for zero catches in blue crab
haul <- p120_core %>% group_by(date, location) %>% mutate(id=row_number()) %>% filter(id==1) %>% as.data.frame() #row every haul (8502 variables whereas Lela had 8099, ok)

length(unique(haul$control1)) #8502 different values of control1 so that is unique tow ID

##Create dummy variable and then fill it with blue crab
haul$Species=NA#create a dummy column first
haul$Species= "C. sapidus"
library(stringr)

haul_df <- haul %>% dplyr::select(control1, program, year, month, day, date, location, nbrrec3, station, time, durationminutes, sedsize, depthm, surfacetemp, bottomtemp, surfacesal, bottomsal, surfaceDO, bottomDO, species, colnum, latdd, longdd, core, Species)
#don't have colnum, samnum, subnum, frequenc, length
#didn't merge with haul.all b/c species are already associated with collection #

hauldf_final <- haul_df %>% select(-colnum) #just want haul information


haul.all=hauldf%>%tidyr::expand(Species,Control1)#this is three times larger so it should have worked
head(haul.all)
haul.all%>%filter(Species=="L. setiferus")#pink and white are in there, so I think it worked



#Merge datasets 
#just want one row with shrimp catches for each species (ColNum) for each station (Control1) without the lengths and grouped by species and station
p120_bc <- p120_core %>% filter(species == "C. sapidus") %>% select(-latdd, -longdd) %>% group_by(control1) %>% mutate(id= row_number()) %>% filter(id== 1) %>% ungroup() %>% as.data.frame()

p120_bc2 <- p120_bc %>% select(control1, date, species, colnum) %>% rename("Species" = "species") #select essentials

##format datasets for merge
hauldf_final$Species=as.factor(hauldf_final$Species)
p120_bc2$Species=as.factor(p120_bc2$Species)
levels(hauldf_final$Species)
levels(p120_bc2$Species)

#haul final species is engineered-want to keep every row of haulfinal and merge shrimp counts in where they exist, not specifying "by" means merge will occur across all common column names
haul_bc =left_join(hauldf_final,p120_bc2) %>% as.data.frame()
head(haul_bc)
str(haul_bc)

haul_bc$time=chron(times=haul_bc$time) #format time correctly

#Calculate CPUE
##Add zeros for NA Catches
summary(haul_bc$colnum) #2209 NAs
haul_bc=haul_bc %>% mutate(colnum=if_else(is.na(colnum),0,as.numeric(colnum)))

#Effort, all tows are 1 minute and speed adjusted to cover 75 yards, headrope is 10.5 feet, so area covered in one tow is 0.02195 hectares
summary(haul_bc$durationminutes)#only 1 minute tows, add ones for NAs, hmm I don't have NAs
haul_bc = haul_bc %>% mutate(durationminutes=if_else(is.na(durationminutes),1,as.numeric(durationminutes)))

haul_bc$Effort=0.02195

haul_bc$CPUE=haul_bc$colnum/haul_bc$Effort
summary(haul_bc$CPUE)

haul_bc %>% filter(year >= 1990, year <= 2019) %>% group_by(year) %>% mutate(CPUE_avg = mean(CPUE)) %>% ggplot(aes(x= year, y= CPUE_avg)) +
geom_line() + geom_point() + standard_theme + xlab("Year") + ylab("Average CPUE") + geom_text(x=2016, y=550, label="C. sapidus", fontface= "italic")

setwd("/Users/sallydowd/Desktop")
ggsave("pamlicodatasets/bc.CPUE.P120.png", width = 7, height = 4, unit = "in")
```

```{r}
#CPUE for all focal species by area by year 
p915_CPUEfoc <- p915_CPUEold %>% drop_na(Latitude, Longitude, Speciescommonname, Colnum) %>% select(Year, Month, Day, Area, Quad, Depth, Speciescommonname, Colnum, Latitude, Longitude, Date, Season, Depth, Ssal, Bsal, Stemp, Sedsize, Btmcomp, Season, Ym_date) %>% filter(!Speciescommonname %in% c("blue crab", "eastern oyster", "brown shrimp", "oyster toadfish", "white shrimp"))
p915_CPUEfoc <- p915_CPUEfoc %>% mutate("Soak_time" = ifelse(Area == 'CAPEF' & Month  %in% c(04, 05, 06, 07, 08, 09), 240, ifelse(Area == 'NEWR' & Month %in% c(04, 05, 06, 07, 08, 09), 240, 720))) #add in standard soak time, max is 12 hours, soak time 4 hours for CAPEF and NEWR b/w April and September
p915_CPUEfoc$CPUE= p915_CPUEfoc$Colnum/p915_CPUEfoc$Soak_time #calculate CPUE



CPUE_graph <- function(df, species, CPUE_metricn){
df %>% filter(Species %in% species) %>% ggplot(aes(x= Year, y= CPUE_avg)) +
geom_line() + geom_point() + xlab("Year") + ylab(CPUE_metricn) + standard_theme
}


#By year: doesn't produce clear trends 
p915_CPUEfoc_yr <- p915_CPUEfoc %>% group_by(Species, Year) %>% summarise(CPUE_avg = mean(CPUE)) %>% distinct(CPUE_avg, .keep_all= TRUE)
CPUE_graph(p915_CPUEfoc_yr, "bonnethead hammerhead", "Average CPUE") 
CPUE_graph(p915_CPUEfoc_yr, "atlantic croaker", "Average CPUE") 
CPUE_graph(p915_CPUEfoc_yr, "black drum", "Average CPUE") 
CPUE_graph(p915_CPUEfoc_yr, "red drum", "Average CPUE") 
CPUE_graph(p915_CPUEfoc_yr, "sheepshead", "Average CPUE") 
CPUE_graph(p915_CPUEfoc_yr, "southern flounder", "Average CPUE") 
CPUE_graph(p915_CPUEfoc_yr, "southern kingfish", "Average CPUE") 
CPUE_graph(p915_CPUEfoc_yr, "striped bass", "Average CPUE") 
CPUE_graph(p915_CPUEfoc_yr, "blue catfish", "Average CPUE") 

#By year, area: some trends 
p915_CPUEfoc_yra <- p915_CPUEfoc %>% group_by(Species, Year, Area) %>% summarise(CPUE_avg = mean(CPUE)) %>% distinct(CPUE_avg, .keep_all= TRUE)

CPUE_graph(p915_CPUEfoc_yra, "bonnethead hammerhead", "Average CPUE") + facet_wrap(~Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yra, "atlantic croaker", "Average CPUE") + facet_wrap(~Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yra, "black drum", "Average CPUE") + facet_wrap(~Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yra, "red drum", "Average CPUE") + facet_wrap(~Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yra, "sheepshead", "Average CPUE") + facet_wrap(~Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yra, "southern flounder", "Average CPUE") + facet_wrap(~Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yra, "southern kingfish", "Average CPUE") + facet_wrap(~Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yra, "striped bass", "Average CPUE") + facet_wrap(~Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yra, "blue catfish", "Average CPUE") + facet_wrap(~Area, scales= "free")

#By season, year
p915_CPUEfoc_yrs <- p915_CPUEfoc %>% group_by(Species, Season, Year) %>% summarise(CPUE_avg = mean(CPUE)) %>% distinct(CPUE_avg, .keep_all= TRUE)
CPUE_graph(p915_CPUEfoc_yrs, "bonnethead hammerhead", "Average CPUE") + facet_wrap(~Season, scales= "free")
CPUE_graph(p915_CPUEfoc_yrs, "atlantic croaker", "Average CPUE") + facet_wrap(~Season, scales= "free")
CPUE_graph(p915_CPUEfoc_yrs, "black drum", "Average CPUE") + facet_wrap(~Season, scales= "free")
CPUE_graph(p915_CPUEfoc_yrs, "red drum", "Average CPUE") + facet_wrap(~Season, scales= "free")
CPUE_graph(p915_CPUEfoc_yrs, "sheepshead", "Average CPUE") + facet_wrap(~Season, scales= "free")
CPUE_graph(p915_CPUEfoc_yrs, "southern flounder", "Average CPUE") + facet_wrap(~Season, scales= "free")
CPUE_graph(p915_CPUEfoc_yrs, "southern kingfish", "Average CPUE") + facet_wrap(~Season, scales= "free")
CPUE_graph(p915_CPUEfoc_yrs, "striped bass", "Average CPUE") + facet_wrap(~Season, scales= "free")
CPUE_graph(p915_CPUEfoc_yrs, "blue catfish", "Average CPUE") + facet_wrap(~Season, scales= "free")

#By season, area 
p915_CPUEfoc_yrsa <- p915_CPUEfoc %>% group_by(Species, Season, Year, Area) %>% summarise(CPUE_avg = mean(CPUE)) %>% distinct(CPUE_avg, .keep_all= TRUE)

CPUE_graph(p915_CPUEfoc_yrsa, "bonnethead hammerhead", "Average CPUE") + facet_wrap(~Season + Area, scales= "free")
ggsave("/users/sallydowd/desktop/allspecs.P915.jpg", width=25, height= 25, units= c("cm"))

CPUE_graph(p915_CPUEfoc_yrsa, "red drum", "Average CPUE") + facet_wrap(~Season + Area, scales= "free")
ggsave("/users/sallydowd/desktop/allspecs.P915.jpg", width=25, height= 25, units= c("cm"))

CPUE_graph(p915_CPUEfoc_yrsa, "blue catfish", "Average CPUE") + facet_wrap(~Season + Area, scales= "free")
ggsave("/users/sallydowd/desktop/allspecs.P915.jpg", width=25, height= 25, units= c("cm"))

#By depth, year
p915_CPUEfoc_yrd <- p915_CPUEfoc %>% group_by(Species, Year, Quad) %>% summarise(CPUE_avg = mean(CPUE)) %>% distinct(CPUE_avg, .keep_all= TRUE)
CPUE_graph(p915_CPUEfoc_yrd, "bonnethead hammerhead", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrd, "atlantic croaker", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrd, "black drum", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrd, "red drum", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrd, "sheepshead", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrd, "southern flounder", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrd, "southern kingfish", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrd, "striped bass", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrd, "blue catfish", "Average CPUE") + facet_wrap(~Quad, scales= "free")

#By depth, area, year
p915_CPUEfoc_yrda <- p915_CPUEfoc %>% group_by(Species, Year, Quad, Area) %>% summarise(CPUE_avg = mean(CPUE)) %>% distinct(CPUE_avg, .keep_all= TRUE)
CPUE_graph(p915_CPUEfoc_yrda, "bonnethead hammerhead", "Average CPUE") + facet_wrap(~Quad + Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yrda, "atlantic croaker", "Average CPUE") + facet_wrap(~Quad, scales= "free")
CPUE_graph(p915_CPUEfoc_yrda, "black drum", "Average CPUE") + facet_wrap(~Quad + Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yrda, "red drum", "Average CPUE") + facet_wrap(~Quad + Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yrda, "sheepshead", "Average CPUE") + facet_wrap(~Quad + Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yrda, "southern flounder", "Average CPUE") + facet_wrap(~Quad + Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yrda, "southern kingfish", "Average CPUE") + facet_wrap(~Quad + Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yrda, "striped bass", "Average CPUE") + facet_wrap(~Quad + Area, scales= "free")
CPUE_graph(p915_CPUEfoc_yrda, "blue catfish", "Average CPUE") + facet_wrap(~Quad + Area, scales= "free")
```
