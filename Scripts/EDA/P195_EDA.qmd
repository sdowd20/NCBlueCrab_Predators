---
title: "P195_EDA"
format: html
editor: visual
---

#### Overall data set description

P195 is a stratified-random trawl survey that has collected both biotic and abiotic information since 1987 in both June and September in Pamlico Sound and its tributaries. In 1990, all sampling in the Albemarle Sound and the March and December sampling in Pamlico Sound was elmiinated. The survey uses two 30-foot head rope demersal mongoose trawls to sample waters within Pamlico Sound as well as the Pamlico, Neuse, and Pungo rivers (4 areas). As there are both deep and shallow sampling sites for the two locations in Pamlico Sound, the survey area is divided into seven strata. Since the survey is stratified-random, fifty-four stations are selected at random from the seven strata for June and September. The fishing effort is kept consistent with 20 minute tows at a speed of 2.5 knots to cover 87,750 square feet. The catch from the two nets are combined to form a single sample.

The survey collects total abundance and weight for each species found, environmental information at the site, and additional length data for target species. A total number and weight is recorded for each species. For target species, at least 30 individuals are measured and total weights are recorded. Water clarity started to be recorded in 2008 with a Secchi disk and shoreline and sediment data started to be recorded in 2009.

On 07/07/23, I downloaded Abundance and Biomass & Event Information from the SEAMAP website for the Pamlico Sound Survey and processed it in Toclean.R. The downloaded files had all years available, all locations, latitudes, were for Summer (June, July, and August) as well as Fall (September, October, and November), and contained all species. Although I had downloaded it in April to use it for BIOL 562 project, I decided it would be better to redownload for the purpose of this study.

```{r}
##Load packages and functions 
packages <- c("ggplot2", "tidyverse", "lubridate", "sf", "sp", "dplyr", "rnaturalearth", "readr", "readxl", "spatialEco", "tidyr")

invisible(lapply(packages, library, character.only= TRUE))

standard_theme <- theme_bw() + theme(panel.border = element_rect(fill=NA, colour = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.text.align= 0, legend.title= element_text(size = 12), legend.text = element_text(size= 10), axis.text=element_text(size=10), axis.title=element_text(size=12))

world <- ne_countries(scale = "medium", returnclass = "sf")

coords_captured <- function(species){
ggplot(data = world) + geom_sf() + geom_point(data = subset(p915_CPUEold, p915_CPUEold$Species %in% species & as.numeric(p915_CPUEold$Colnum > 0)), aes(x = as.numeric(Longitude), y = as.numeric(Latitude), colour = Colnum)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") + ggtitle(species)
}

p195_abund <- read_csv("~/Documents/GitHub/NCBlueCrab_Predators/Data/P195/Finalized/p195_abund.csv")
p195_abund_edt <- p195_abund %>% filter(Month == 6| Month== 9, Year > 2000, !Location %in% "ALBEMARLE SOUND")
p195_abund_edt$Season <- ifelse(p195_abund_edt$Month==4 | p195_abund_edt$Month==5 | p195_abund_edt$Month==6, "Spring", ifelse(p195_abund_edt$Month==9 |p195_abund_edt$Month==10 | p195_abund_edt$Month==11 | p195_abund_edt$Month==12, "Fall", ifelse(p195_abund_edt$Month==7 |p195_abund_edt$Month==8, "Summer", "Winter")))
p195_abund_edt$Ym_date <- format(p195_abund_edt$Date, "%Y-%m")

t <- p195_abund_edt %>% filter(Season %in% "Summer")
unique(t$Month)
```

#### General

```{r}
summary(is.na(p195_abund_edt)) #NAs present Speciescommonname (expected), Numbertotal, biological characteristics, environmental variables, Latitudestart, Longitudestart
summary(is.na(subset(p195_abund_edt, Year > 2008))) #less NAs in environmental variables after 2008 

#Spatial orientation
##All stations
ggplot(data = world) + geom_sf() + geom_point(data = p195_abund_edt, aes(x = Longitudestart, y = Latitudestart)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude")

##Stations
length(unique(p195_abund$Stationcode)) #1189 stations
ggplot(data = world) + geom_sf() + geom_point(data = p195_abund_edt, aes(x = Longitudestart, y = Latitudestart, colour= Stationcode)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") + guides(colour= FALSE)

stationcount <- p195_abund_edt %>% group_by(Stationcode) %>% mutate(count= n()) %>% distinct(count, .keep_all= TRUE) %>% dplyr::select(count, Stationcode) #times a station is sampled runs from 1-222, need to explore this more 

#Sampling effort: general
p195_abund_edt %>% group_by(Date, Location) %>% mutate(ID=row_number()) %>% filter(ID==1) %>% ggplot() + geom_histogram(aes(x= Year)) + facet_wrap(~Location) + standard_theme #Number of sampling points, makes sense bc Pamlico Sound has deep and shallow sets
p195_abund_edt %>% group_by(Date, Location, Depthzone) %>% mutate(ID=row_number()) %>% filter(ID==1) %>% ggplot() + geom_histogram(aes(x= Year)) + facet_wrap(~Location + Depthzone) + standard_theme #Sampling amount throughout strata (locations plus shallow and deep look good)
p195_abund_edt %>% group_by(Location, Depthzone, Date) %>% distinct(Ym_date, .keep_all= TRUE) %>% ggplot() + geom_histogram(stat="count", aes(x=Ym_date, fill = Location)) + standard_theme + facet_wrap(~Depthzone) #consistent sampling: less sampling in rivers than main Pamlico Sound even when divide by depth 
#I think this is right as opposed to: p195_abund_edt %>% ggplot() + geom_histogram(stat="count", aes(x=Ym_date, fill = Location)) + standard_theme

p195_abund_edt %>% group_by(Date, Latitudestart, Longitudestart) %>% summarize(abundance= mean(Numbertotal)) %>% ggplot() + geom_point(aes(x= Date, y= abundance)) + standard_theme #sum outliers with mean abundance to correct for
```

#### Species specific: spatial and temporal

```{r}
coords_captured <- function(species){
ggplot(data = world) + geom_sf() + geom_point(data = subset(p195_abund_edt, p195_abund_edt$Speciescommonname %in% species & as.numeric(p195_abund_edt$Numbertotal > 0)), aes(x = as.numeric(Longitudestart), y = as.numeric(Latitudestart), colour = Numbertotal)) + coord_sf(xlim=c(-78, -75), ylim=c(34,37), expand = TRUE) + theme(panel.background = element_rect(fill = "white", colour = "black")) + labs(x= "Longitude", y= "Latitude", colour= "# caught") + ggtitle(species)
}

coords_captured("brown shrimp")
coords_captured("bluefish")
coords_captured("atlantic croaker")
coords_captured("southern flounder")
coords_captured("red drum") #red drum and black drum aren't really caught
coords_captured("black drum")
coords_captured("blue catfish") #blue catfish aren't around 
coords_captured("gizzard shad") #shads not really caught 
coords_captured("american shad")
coords_captured("cownose ray") #plenty of cownose rays 
coords_captured("blue crab")

coords_captured("bonnethead hammerhead")
coords_captured("blue crab") 
coords_captured("blue catfish") 
coords_captured("red drum") 
coords_captured("southern kingfish") 
coords_captured("southern flounder") 
coords_captured("striped bass")

#Temporal:
interest_spp <- c("brown shrimp", "bluefish", "atlantic croaker", "southern flounder", "red drum", "black drum", "blue catfish", "gizzard shad", "american shad", "cownose ray", "blue crab", "atlantic menhaden", "spot", "summer flounder", "shads", "american eel", "bonnethead hammerhead", "southern kingfish", "striped bass")
fine <- p195_abund_edt %>% filter(Speciescommonname %in% interest_spp, Month == 6| Month== 9, Year > 2008) #species of interest
ggplot() + geom_histogram(data = subset(fine, fine$Numbertotal > 0), stat="count", aes(x=factor(Month))) + standard_theme + facet_wrap(~Speciescommonname, scales= "free") + xlab("Month")

#Seasonally: 
#Fall: atlantic croaker, atlantic menhaden, black drum? blue crab, bluefish, brown shrimp, cownose ray, gizzard shad, southern flounder, spot, summer flounder, southern kingfish
#Spring: atlantic croaker, atlantic menhaden, blue crab, bluefish, brown shrimp, cownose ray, gizzard shad? southern flounder, spot, summer flounder, southern kingfish

##Number of observations for species of interest
p195_nums <- fine %>% group_by(Speciescommonname, Month) %>% drop_na(Numbertotal) %>% summarise(Sum_colnum= sum(Numbertotal)) %>% mutate(Survey= "P120") #atlantic croaker, atlantic menhaden, blue crab, bluefish, northern brown shrimp, southern flounder, southern kingfish, spot, and summer flounder have the most data

###Combine with other datasets
p120_nums <- P120_bioledt %>% filter(Speciescommonname %in% interest_spp, Month == 5|Month==6) %>% group_by(Speciescommonname, Month) %>% drop_na(Colnum) %>% summarise(Sum_colnum= sum(Colnum)) %>% mutate(Survey= "P120")

p915_nums <- p915_CPUE %>% filter(Speciescommonname %in% interest_spp, Month == 5|Month==6|Month==9) %>% group_by(Speciescommonname, Month) %>% drop_na(Colnum) %>% summarise(Sum_colnum= sum(Colnum)) %>% mutate(Survey= "P915")

survey_seasonality <- rbind(p195_nums, p120_nums, p915_nums)
#write.csv(test, "~/Desktop/Survey_seasonality.csv")
```
